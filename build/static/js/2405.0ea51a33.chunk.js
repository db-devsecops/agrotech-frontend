"use strict";(self.webpackChunkagrotech_frontend=self.webpackChunkagrotech_frontend||[]).push([[2405,7100],{42405:function(e,r,t){t.r(r),t.d(r,{save:function(){return X},saveAll:function(){return ee},saveAs:function(){return re}});var n=t(93433),a=t(37762),u=t(15861),s=t(87757),o=t(59537),i=t(77284),l=t(84615),c=t(77822),p=t(71453),f=t(57058),d=t(29082),y=t(97100),v=t(86043),m=t(7969),h=t(43459),b=t(40740),x=t(95610),w=t(74021),I=l.Z.getLogger("esri.layers.FeatureLayer"),S="Feature Service";function k(e,r){return"Layer (title: ".concat(e.title,", id: ").concat(e.id,") of type '").concat(e.declaredClass,"' ").concat(r)}function Z(e,r){if(r.type!==S)throw new i.Z("feature-layer:portal-item-wrong-type",k(e,'should have portal item of type "'.concat(S,'"')))}function g(e){return O.apply(this,arguments)}function O(){return(O=(0,u.Z)(s.mark((function e(r){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.load();case 2:if(!(0,m.rQ)(r)){e.next=4;break}throw new i.Z("feature-layer:save",k(r,"using an in-memory source cannot be saved to a portal item"));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e,r){var t=e.messages.filter((function(e){return"error"===e.type})).map((function(e){var r=e.name,t=e.message,n=e.details;return new i.Z(r,t,n)}));if(null!==r&&void 0!==r&&r.ignoreUnsupported&&(t=t.filter((function(e){var r=e.name;return"layer:unsupported"!==r&&"symbol:unsupported"!==r&&"symbol-layer:unsupported"!==r&&"property:unsupported"!==r&&"url:unsupported"!==r}))),t.length>0)throw new i.Z("feature-layer:save","Failed to save feature layer due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:t})}function L(e,r,t){return T.apply(this,arguments)}function T(){return(T=(0,u.Z)(s.mark((function e(r,t,n){var a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0="beforeSave"in r&&"function"==typeof r.beforeSave,!e.t0){e.next=4;break}return e.next=4,r.beforeSave();case 4:return a=r.write({},t),e.abrupt("return",(P(t,n),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){var r=e.layer,t=e.layerJSON;return r.isTable?{layers:[],tables:[t]}:{layers:[t],tables:[]}}function C(e){(0,w.qj)(e,w.Kz.JSAPI),e.typeKeywords&&(e.typeKeywords=e.typeKeywords.filter((function(e,r,t){return t.indexOf(e)===r})))}function J(e){var r=e.portalItem;if(!r)throw I.error("save: requires the portalItem property to be set"),new i.Z("feature-layer:portal-item-not-set",k(e,"requires the portalItem property to be set"));if(!r.loaded)throw new i.Z("feature-layer:portal-item-not-loaded",k(e,"cannot be saved to a portal item that does not exist or is inaccessible"));Z(e,r)}function F(e,r){return D.apply(this,arguments)}function D(){return(D=(0,u.Z)(s.mark((function e(r,t){return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",/\/\d+\/?$/.test(r.url)?N(t[0]):K(r,t));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function K(e,r){return A.apply(this,arguments)}function A(){return(A=(0,u.Z)(s.mark((function e(r,t){var n,u,o,i,l,c,p,f;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t[0].layer,u=n.url,o=n.customParameters,i=n.apiKey,e.next=3,r.fetchData("json");case 3:if(l=e.sent,e.t0=l&&null!=l.layers&&null!=l.tables,e.t0){e.next=9;break}return e.next=8,E(l,{url:u,customParameters:o,apiKey:i},t.map((function(e){return e.layer.layerId})));case 8:l=e.sent;case 9:c=(0,a.Z)(t);try{for(c.s();!(p=c.n()).done;)j((f=p.value).layer,f.layerJSON,l)}catch(s){c.e(s)}finally{c.f()}return e.abrupt("return",l);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function E(e,r,t){return U.apply(this,arguments)}function U(){return(U=(0,u.Z)(s.mark((function e(r,t,a){var u,o,i,l,c,p,f,d,v,m,h,b;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r||(r={}),(u=r).layers||(u.layers=[]),(o=r).tables||(o.tables=[]),i=t.url,l=t.customParameters,c=t.apiKey,e.next=6,(0,y.fetchFeatureService)(i,{customParameters:l,apiKey:c});case 6:return p=e.sent,f=p.serviceJSON,d=p.layersJSON,v=R(r.layers,f.layers,a),m=R(r.tables,f.tables,a),r.layers=v.itemResources,r.tables=m.itemResources,h=[].concat((0,n.Z)(v.added),(0,n.Z)(m.added)),b=d?[].concat((0,n.Z)(d.layers),(0,n.Z)(d.tables)):[],e.next=15,z(r,h,i,b);case 15:return e.abrupt("return",r);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function R(e,r,t){var n=(0,o.e5)(e,r,(function(e,r){return e.id===r.id}));e=e.filter((function(e){return!n.removed.some((function(r){return r.id===e.id}))}));var a=n.added.map((function(e){return{id:e.id}}));return a.forEach((function(r){var t=r.id;e.push({id:t})})),{itemResources:e,added:a.filter((function(e){var r=e.id;return!t.includes(r)}))}}function z(e,r,t,n){return M.apply(this,arguments)}function M(){return(M=(0,u.Z)(s.mark((function e(r,t,n,a){var u;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.map((function(e){var r=e.id;return new d.default({url:n,layerId:r,sourceJSON:a.find((function(e){return e.id===r}))})})),e.next=3,(0,p.as)(u.map((function(e){return e.load()})));case 3:u.forEach((function(e){var t=e.layerId,n=e.loaded,a=e.defaultPopupTemplate;n&&!(0,c.Wi)(a)&&j(e,{id:t,popupInfo:a.toJSON()},r)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,r,t){e.isTable?V(t.tables,r):V(t.layers,r)}function V(e,r){var t=e.findIndex((function(e){return e.id===r.id}));-1===t?e.push(r):e[t]=r}function q(e){var r=e.portalItem;return(0,m.y2)(e)&&!e.dynamicDataSource&&!(null===r||void 0===r||!r.loaded)&&r.type===S}function Y(e){return _.apply(this,arguments)}function _(){return(_=(0,u.Z)(s.mark((function e(r){var t,n,u,o,l;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==r&&void 0!==r&&r.length){e.next=2;break}throw new i.Z("feature-layer-utils-saveall:missing-parameters","'layers' array should contain at least one feature layer");case 2:return e.next=4,Promise.all(r.map((function(e){return e.load()})));case 4:t=(0,a.Z)(r),e.prev=5,t.s();case 7:if((n=t.n()).done){e.next=13;break}if(q(u=n.value)){e.next=11;break}throw new i.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should only contain layers or tables in a feature service loaded from 'Feature Service' item. ".concat(k(u,"does not conform")),{layer:u});case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),t.e(e.t0);case 18:return e.prev=18,t.f(),e.finish(18);case 21:if(o=r.map((function(e){return e.portalItem.id})),!(new Set(o).size>1)){e.next=24;break}throw new i.Z("feature-layer-utils-saveall:invalid-parameters","All layers in the 'layers' array should be loaded from the same portal item");case 24:if(l=r.map((function(e){return e.layerId})),new Set(l).size===l.length){e.next=27;break}throw new i.Z("feature-layer-utils-saveall:invalid-parameters","'layers' array should contain only one instance each of layer or table in a feature service");case 27:case"end":return e.stop()}}),e,null,[[5,15,18,21]])})))).apply(this,arguments)}function B(e,r){var t,n,a,u,s=b.default.from(r);return s.id&&((s=s.clone()).id=null),null!==(t=(a=s).type)&&void 0!==t||(a.type=S),null!==(n=(u=s).portal)&&void 0!==n||(u.portal=h.Z.getDefault()),Z(e,s),s}function Q(e,r){return W.apply(this,arguments)}function W(){return(W=(0,u.Z)(s.mark((function e(r,t){var n,a,u,o,i,l,p;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.url,a=r.layerId,u=r.title,o=r.fullExtent,i=r.isTable,l=(0,v.Qc)(n),p=(0,c.pC)(l)&&"FeatureServer"===l.serverType,t.url=p?n:"".concat(n,"/").concat(a),t.title||(t.title=u),t.extent=null,e.t0=!i&&(0,c.pC)(o),!e.t0){e.next=9;break}return e.next=8,(0,w.$o)(o);case 8:t.extent=e.sent;case 9:(0,w.ck)(t,w.Kz.METADATA),(0,w.ck)(t,w.Kz.MULTI_LAYER),(0,w.qj)(t,w.Kz.SINGLE_LAYER),i&&(0,w.qj)(t,w.Kz.TABLE),C(t);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $(e,r,t){return G.apply(this,arguments)}function G(){return(G=(0,u.Z)(s.mark((function e(r,t,n){var a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.portal,e.next=3,a._signIn();case 3:return e.next=5,a.user.addItem({item:r,data:t,folder:null===n||void 0===n?void 0:n.folder});case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var X=(0,p.Ds)((function(e,r){return H.apply(this,arguments)}));function H(){return(H=(0,u.Z)(s.mark((function e(r,t){var n,a,u,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(r);case 2:return J(r),n=r.portalItem,a=(0,x.Y)(n),e.next=7,L(r,a,t);case 7:return u=e.sent,e.next=10,F(n,[{layer:r,layerJSON:u}]);case 10:return o=e.sent,C(n),e.next=14,n.update({data:o});case 14:return(0,f.D)(a),e.abrupt("return",n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ee=(0,p.Ds)(function(){var e=(0,u.Z)(s.mark((function e(r,t){var n,a,u,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Y(r);case 2:return n=r[0].portalItem,a=(0,x.Y)(n),e.next=6,Promise.all(r.map((function(e){return L(e,a,t)})));case 6:return u=e.sent,e.next=9,F(n,r.map((function(e,r){return{layer:e,layerJSON:u[r]}})));case 9:return o=e.sent,C(n),e.next=13,n.update({data:o});case 13:return e.next=15,Promise.all(r.slice(1).map((function(e){return e.portalItem.reload()})));case 15:return(0,f.D)(a),e.abrupt("return",n.clone());case 17:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}()),re=(0,p.Ds)((function(e,r,t){return te.apply(this,arguments)}));function te(){return(te=(0,u.Z)(s.mark((function e(r,t,n){var a,u,o;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(r);case 2:return a=B(r,t),u=(0,x.Y)(a),e.t0=N,e.t1=r,e.next=8,L(r,u,n);case 8:return e.t2=e.sent,e.t3={layer:e.t1,layerJSON:e.t2},o=(0,e.t0)(e.t3),e.next=13,Q(r,a);case 13:return e.next=15,$(a,o,n);case 15:return r.portalItem=a,(0,f.D)(u),e.abrupt("return",a);case 18:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},97100:function(e,r,t){t.r(r),t.d(r,{fetchFeatureService:function(){return Z},fromUrl:function(){return f}});var n=t(1413),a=t(15861),u=t(87757),s=t(86755),o=t(77284),i=t(77822),l=t(68868),c=t(86043),p=t(73909);function f(e){return d.apply(this,arguments)}function d(){return(d=(0,a.Z)(u.mark((function e(r){var a,s,o,i,l;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=null===(a=r.properties)||void 0===a?void 0:a.customParameters,e.next=3,m(r.url,s);case 3:if(o=e.sent,i=(0,n.Z)((0,n.Z)({},r.properties),{},{url:r.url}),o.sublayerIds){e.next=7;break}return e.abrupt("return",(null!=o.layerOrTableId&&(i.layerId=o.layerOrTableId,i.sourceJSON=o.sourceJSON),new o.Constructor(i)));case 7:return e.next=10,t.e(4155).then(t.bind(t,4155));case 10:return e.t0=e.sent.default,e.t1={title:o.parsedUrl.title},l=new e.t0(e.t1),e.abrupt("return",(v(l,o,i),l));case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e,r){return e?e.find((function(e){return e.id===r})):null}function v(e,r,t){function a(e,a){var u=(0,n.Z)((0,n.Z)({},t),{},{layerId:e,sublayerTitleMode:"service-name"});return(0,i.pC)(a)&&(u.sourceJSON=a),new r.Constructor(u)}r.sublayerIds.forEach((function(t){var n=a(t,y(r.sublayerInfos,t));e.add(n)})),r.tableIds.forEach((function(t){var n=a(t,y(r.tableInfos,t));e.tables.add(n)}))}function m(e,r){return h.apply(this,arguments)}function h(){return h=(0,a.Z)(u.mark((function e(r,t){var n,a,s,l,p,f,d,y,v,m,h,x,w;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=(0,c.Qc)(r),e.t0=(0,i.Wi)(n),!e.t0){e.next=6;break}return e.next=5,b(r,t);case 5:n=e.sent;case 6:if(!(0,i.Wi)(n)){e.next=8;break}throw new o.Z("arcgis-layers:url-mismatch","The url '${url}' is not a valid arcgis resource",{url:r});case 8:s=(a=n).serverType,l=a.sublayer,f={FeatureServer:"FeatureLayer",StreamServer:"StreamLayer",VectorTileServer:"VectorTileLayer"},e.t1=s,e.next="MapServer"===e.t1?13:"ImageServer"===e.t1?15:"SceneServer"===e.t1?17:19;break;case 13:return p=null!=l?"FeatureLayer":L(r,t).then((function(e){return e?"TileLayer":"MapImageLayer"})),e.abrupt("break",20);case 15:return p=N(r,{customParameters:t}).then((function(e){var r=e.tileInfo&&e.tileInfo.format;return e.tileInfo?"LERC"!==(null===r||void 0===r?void 0:r.toUpperCase())||e.cacheType&&"elevation"!==e.cacheType.toLowerCase()?"ImageryTileLayer":"ElevationLayer":"ImageryLayer"})),e.abrupt("break",20);case 17:return p=N(n.url.path,{customParameters:t}).then((function(e){if(e){if("Voxel"===(null===e||void 0===e?void 0:e.layerType))return"VoxelLayer";if(null!==e&&void 0!==e&&e.layers&&Array.isArray(e.layers)&&e.layers.length>0){var r,t={Point:"SceneLayer","3DObject":"SceneLayer",IntegratedMesh:"IntegratedMeshLayer",PointCloud:"PointCloudLayer",Building:"BuildingSceneLayer"},n=null===(r=e.layers[0])||void 0===r?void 0:r.layerType;if(null!=t[n])return t[n]}}return"SceneLayer"})),e.abrupt("break",20);case 19:p=f[s];case 20:return d={FeatureLayer:!0,SceneLayer:!0},v={parsedUrl:n,Constructor:null,layerOrTableId:(y="FeatureServer"===s)?l:null,sublayerIds:null,tableIds:null},e.next=25,p;case 25:if(m=e.sent,!d[m]||null!=l){e.next=32;break}return e.next=29,I(r,s,t);case 29:w=e.sent,y&&(v.sublayerInfos=w.layerInfos,v.tableInfos=w.tableInfos),1!==w.layerIds.length+w.tableIds.length?(v.sublayerIds=w.layerIds,v.tableIds=w.tableIds):y&&(v.layerOrTableId=null!==(h=w.layerIds[0])&&void 0!==h?h:w.tableIds[0],v.sourceJSON=null!==(x=w.layerInfos[0])&&void 0!==x?x:w.tableInfos[0]);case 32:return e.next=34,O(m);case 34:return v.Constructor=e.sent,e.abrupt("return",v);case 36:case"end":return e.stop()}}),e)}))),h.apply(this,arguments)}function b(e,r){return x.apply(this,arguments)}function x(){return x=(0,a.Z)(u.mark((function e(r,t){var n,a,s,o,p,f;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(r,{customParameters:t});case 2:if(a=e.sent,s=null,o=null,"Feature Layer"===(p=a.type)||"Table"===p?(s="FeatureServer",o=a.id):"indexedVector"===p?s="VectorTileServer":a.hasOwnProperty("mapName")?s="MapServer":a.hasOwnProperty("bandCount")&&a.hasOwnProperty("pixelSizeX")?s="ImageServer":a.hasOwnProperty("maxRecordCount")&&a.hasOwnProperty("allowGeometryUpdates")?s="FeatureServer":a.hasOwnProperty("streamUrls")?s="StreamServer":w(a)?(s="SceneServer",o=a.id):a.hasOwnProperty("layers")&&w(null===(n=a.layers)||void 0===n?void 0:n[0])&&(s="SceneServer"),s){e.next=7;break}return e.abrupt("return",null);case 7:return f=null!=o?(0,c.DR)(r):null,e.abrupt("return",{title:(0,i.pC)(f)&&a.name||(0,l.vt)(r),serverType:s,sublayer:o,url:{path:(0,i.pC)(f)?f.serviceUrl:(0,l.mN)(r).path}});case 9:case"end":return e.stop()}}),e)}))),x.apply(this,arguments)}function w(e){return(null===e||void 0===e?void 0:e.hasOwnProperty("store"))&&e.hasOwnProperty("id")&&"number"==typeof e.id}function I(e,r,t){return S.apply(this,arguments)}function S(){return(S=(0,a.Z)(u.mark((function e(r,t,n){var a,s,o,i,l,c,p;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!1,"FeatureServer"!==t){e.next=8;break}return e.next=4,Z(r,{customParameters:n});case 4:l=e.sent,i=!!l.layersJSON,o=l.layersJSON||l.serviceJSON,e.next=11;break;case 8:return e.next=10,N(r,{customParameters:n});case 10:o=e.sent;case 11:return c=null===(a=o)||void 0===a?void 0:a.layers,p=null===(s=o)||void 0===s?void 0:s.tables,e.abrupt("return",{layerIds:(null===c||void 0===c?void 0:c.map((function(e){return e.id})).reverse())||[],tableIds:(null===p||void 0===p?void 0:p.map((function(e){return e.id})).reverse())||[],layerInfos:i?c:[],tableInfos:i?p:[]});case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return!e.type||"Feature Layer"===e.type}function Z(e,r){return g.apply(this,arguments)}function g(){return(g=(0,a.Z)(u.mark((function e(r,t){var n,a,s,o,i;return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(r,t);case 2:if((s=(s=e.sent)||{}).layers=(null===(n=s.layers)||void 0===n?void 0:n.filter(k))||[],o={serviceJSON:s},!(s.currentVersion<10.5)){e.next=7;break}return e.abrupt("return",o);case 7:return e.next=9,N(r+"/layers",t);case 9:return i=e.sent,e.abrupt("return",(o.layersJSON={layers:(null===i||void 0===i||null===(a=i.layers)||void 0===a?void 0:a.filter(k))||[],tables:(null===i||void 0===i?void 0:i.tables)||[]},o));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return P.apply(this,arguments)}function P(){return(P=(0,a.Z)(u.mark((function e(r){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,p.T[r])());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e,r){return T.apply(this,arguments)}function T(){return(T=(0,a.Z)(u.mark((function e(r,t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(r,{customParameters:t});case 2:return e.abrupt("return",e.sent.tileInfo);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e,r){return C.apply(this,arguments)}function C(){return(C=(0,a.Z)(u.mark((function e(r,t){return u.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,s.default)(r,{responseType:"json",query:(0,n.Z)((0,n.Z)({f:"json"},null===t||void 0===t?void 0:t.customParameters),{},{token:null===t||void 0===t?void 0:t.apiKey})});case 2:return e.abrupt("return",e.sent.data);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},95610:function(e,r,t){t.d(r,{h:function(){return u},Y:function(){return s}});var n=t(68868),a=t(43459);function u(e){return{origin:"portal-item",url:(0,n.mN)(e.itemUrl),portal:e.portal||a.Z.getDefault(),portalItem:e,readResourcePaths:[]}}function s(e){return{origin:"portal-item",messages:[],writtenProperties:[],url:e.itemUrl?(0,n.mN)(e.itemUrl):null,portal:e.portal||a.Z.getDefault(),portalItem:e}}}}]);