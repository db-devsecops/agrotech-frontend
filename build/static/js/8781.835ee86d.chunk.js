"use strict";(self.webpackChunkagrotech_frontend=self.webpackChunkagrotech_frontend||[]).push([[8781],{68781:function(e,t,r){r.d(t,{q:function(){return P}});var n=r(1413),i=r(37762),s=r(15861),u=r(43144),a=r(15671),c=r(87757),o=r(59537),l=r(77284),p=r(37924),f=r(77822),h=r(24869),y=r(28562),d=r(79104),m=r(82626),x=r(61069),v=r(685),g=r(392),S=r(94613),b=r(90289),k=r(83731),_=r(85817),w=r(97615),R=r(79032),F=r(20881),I=r(27889),Q=r(45371),Z=r(31082),C=r(37698),A=r(46389);var E="feature-store:unsupported-query",T=new h.WJ(2e6),G=0,P=function(){function e(t){var r=this;(0,a.Z)(this,e),this.capabilities={query:w.g},this.geometryType=t.geometryType,this.hasM=t.hasM,this.hasZ=t.hasZ,this.objectIdField=t.objectIdField,this.spatialReference=t.spatialReference,this.definitionExpression=t.definitionExpression,this.featureStore=t.featureStore,this.aggregateAdapter=t.aggregateAdapter,this._changeHandle=this.featureStore.events.on("changed",(function(){return r.clearCache()})),this.timeInfo=t.timeInfo,t.cacheSpatialQueries&&(this._geometryQueryCache=new h.Xq(G+++"$$",T)),this.fieldsIndex=new Z.Z(t.fields),t.scheduler&&t.priority&&(this._frameTask=t.scheduler.registerTask(t.priority))}return(0,u.Z)(e,[{key:"destroy",value:function(){this._frameTask=(0,f.hw)(this._frameTask),this.clearCache(),(0,f.SC)(this._geometryQueryCache),this._changeHandle=(0,f.hw)(this._changeHandle),(0,f.SC)(this.fieldsIndex)}},{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){var e=this.featureStore.fullBounds;return(0,f.Wi)(e)?null:{xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:(0,Q.S2)(this.spatialReference)}}},{key:"timeExtent",get:function(){return this.timeInfo?(this._timeExtent||(this._timeExtent=(0,I.R)(this.timeInfo,this.featureStore)),this._timeExtent):null}},{key:"clearCache",value:function(){var e;null!==(e=this._geometryQueryCache)&&void 0!==e&&e.clear(),this._allItems=null,this._timeExtent=null}},{key:"executeQuery",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{},r);case 3:return e.abrupt("return",e.sent.createQueryResponse());case 6:if(e.prev=6,e.t0=e.catch(0),e.t0===Q.vF){e.next=10;break}throw e.t0;case 10:return e.abrupt("return",new R.y([],t,this).createQueryResponse());case 11:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForCount",value:function(){var e=(0,s.Z)(c.mark((function e(){var t,r,n=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:{},r=n.length>1?n[1]:void 0,e.prev=2,e.next=5,this._executeQuery(t,{returnGeometry:!1,returnCentroid:!1,outSR:null},r);case 5:return e.abrupt("return",e.sent.createQueryResponseForCount());case 8:if(e.prev=8,e.t0=e.catch(2),e.t0===Q.vF){e.next=12;break}throw e.t0;case 12:return e.abrupt("return",0);case 13:case"end":return e.stop()}}),e,this,[[2,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForExtent",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){var n,i,s,u,a,o,l,p;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.outSR,e.prev=1,e.next=4,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 4:if(i=e.sent,s=i.size){e.next=8;break}return e.abrupt("return",{count:0,extent:null});case 8:return(0,d.t8)(q,d.Gv),this.featureStore.forEachBounds(i.items,(function(e){return(0,d.TC)(q,e)}),O),u={xmin:q[0],ymin:q[1],xmax:q[3],ymax:q[4],spatialReference:(0,Q.S2)(this.spatialReference)},this.hasZ&&isFinite(q[2])&&isFinite(q[5])&&(u.zmin=q[2],u.zmax=q[5]),(a=(0,_.iV)(u,i.spatialReference,n)).spatialReference=(0,Q.S2)(n||this.spatialReference),a.xmax-a.xmin==0&&(o=(0,y.c9)(a.spatialReference),a.xmin-=o,a.xmax+=o),a.ymax-a.ymin==0&&(l=(0,y.c9)(a.spatialReference),a.ymin-=l,a.ymax+=l),this.hasZ&&null!=a.zmin&&null!=a.zmax&&a.zmax-a.zmin==0&&(p=(0,y.c9)(a.spatialReference),a.zmin-=p,a.zmax+=p),e.abrupt("return",{count:s,extent:a});case 18:if(e.prev=18,e.t0=e.catch(1),e.t0!==Q.vF){e.next=22;break}return e.abrupt("return",{count:0,extent:null});case 22:throw e.t0;case 23:case"end":return e.stop()}}),e,this,[[1,18]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIds",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.executeQueryForIdSet(t,r).then((function(e){return Array.from(e)})));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForIdSet",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){var n,s,u;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._executeQuery(t,{returnGeometry:!0,returnCentroid:!1,outSR:null},r);case 3:return n=e.sent,s=n.items,u=new Set,e.next=8,this._reschedule((function(){var e,t=(0,i.Z)(s);try{for(t.s();!(e=t.n()).done;){var r=e.value;u.add(n.featureAdapter.getObjectId(r))}}catch(a){t.e(a)}finally{t.f()}}),r);case 8:return e.abrupt("return",u);case 11:if(e.prev=11,e.t0=e.catch(0),e.t0!==Q.vF){e.next=15;break}return e.abrupt("return",new Set);case 15:throw e.t0;case 16:case"end":return e.stop()}}),e,this,[[0,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSnapping",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){var i,s,u,a,o,l,p,h,y,d,m,x,b,k,w=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.point,s=t.distance,t.types!==R.r.NONE){e.next=3;break}return e.abrupt("return",{candidates:[]});case 3:return e.next=5,this._reschedule((function(){return w._checkQuerySupport(t.query)}),r);case 5:if(u=e.sent,a=!(0,S.fS)(i.spatialReference,this.spatialReference),e.t0=a,!e.t0){e.next=11;break}return e.next=11,(0,_._W)(i.spatialReference,this.spatialReference);case 11:if(o="number"==typeof s?s:s.x,l="number"==typeof s?s:s.y,p={xmin:i.x-o,xmax:i.x+o,ymin:i.y-l,ymax:i.y+l,spatialReference:i.spatialReference},h=a?(0,_.iV)(p,this.spatialReference):p){e.next=14;break}return e.abrupt("return",{candidates:[]});case 14:return e.next=16,(0,g.aX)((0,v.im)(i),null,{signal:r});case 16:return y=e.sent[0],e.next=19,(0,g.aX)((0,v.im)(h),null,{signal:r});case 19:if(d=e.sent[0],!(0,f.Wi)(y)&&!(0,f.Wi)(d)){e.next=22;break}return e.abrupt("return",{candidates:[]});case 22:return m=new R.y(this._searchFeatures(this._getQueryBBoxes(d.toJSON())),u,this),e.next=25,this._reschedule((function(){return w._executeObjectIdsQuery(m)}),r);case 25:return e.next=27,this._reschedule((function(){return w._executeTimeQuery(m)}),r);case 27:return e.next=29,this._reschedule((function(){return w._executeAttributesQuery(m)}),r);case 29:return x=y.toJSON(),b=a?(0,_.iV)(x,this.spatialReference):x,k=a?Math.max(h.xmax-h.xmin,h.ymax-h.ymin)/2:s,e.abrupt("return",m.createSnappingResponse((0,n.Z)((0,n.Z)({},t),{},{point:b,distance:k}),i.spatialReference));case 31:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForLatestObservations",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){var n,i=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.timeInfo&&this.timeInfo.trackIdField){e.next=2;break}throw new l.Z(E,"Missing timeInfo or timeInfo.trackIdField",{query:t,timeInfo:this.timeInfo});case 2:return e.prev=2,e.next=5,this._executeQuery(t,{},r);case 5:return n=e.sent,e.next=8,this._reschedule((function(){return i._filterLatest(n)}),r);case 8:return e.abrupt("return",n.createQueryResponse());case 11:if(e.prev=11,e.t0=e.catch(2),e.t0===Q.vF){e.next=15;break}throw e.t0;case 15:return e.abrupt("return",new R.y([],t,this).createQueryResponse());case 16:case"end":return e.stop()}}),e,this,[[2,11]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"executeQueryForSummaryStatistics",value:function(){var e=(0,s.Z)(c.mark((function e(){var t,r,n,i,s,u,a=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,n=a.length>2?a[2]:void 0,i=r.field,s=r.normalizationField,u=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:s,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createSummaryStatisticsResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForUniqueValues",value:function(){var e=(0,s.Z)(c.mark((function e(){var t,r,n,i,s,u=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]?u[0]:{},r=u.length>1?u[1]:void 0,n=u.length>2?u[2]:void 0,i=r.field,s=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,valueExpression:s},n);case 6:return e.abrupt("return",e.sent.createUniqueValuesResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForClassBreaks",value:function(){var e=(0,s.Z)(c.mark((function e(){var t,r,n,i,s,u,a=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,n=a.length>2?a[2]:void 0,i=r.field,s=r.normalizationField,u=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:s,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createClassBreaksResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"executeQueryForHistogram",value:function(){var e=(0,s.Z)(c.mark((function e(){var t,r,n,i,s,u,a=arguments;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=a.length>0&&void 0!==a[0]?a[0]:{},r=a.length>1?a[1]:void 0,n=a.length>2?a[2]:void 0,i=r.field,s=r.normalizationField,u=r.valueExpression,e.next=6,this._getQueryEngineResultForStats(t,{field:i,normalizationField:s,valueExpression:u},n);case 6:return e.abrupt("return",e.sent.createHistogramResponse(r));case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_schedule",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.pC)(this._frameTask)?this._frameTask.schedule(t,r):t(A.G5));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_reschedule",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,f.pC)(this._frameTask)?this._frameTask.reschedule(t,r):t(A.G5));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getAll",value:function(e){return(0,f.Wi)(this._allItems)&&(this._allItems=this.featureStore.toArray()),new R.y(this._allItems,e,this)}},{key:"_executeQuery",value:function(){var e=(0,s.Z)(c.mark((function e(t,r,i){var s,u,a=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.d9)(t),e.next=3,this._schedule((function(){return(0,Q.Up)(t,a.definitionExpression,a.spatialReference)}),i);case 3:return t=e.sent,e.next=6,this._reschedule((function(){return a._checkQuerySupport(t)}),i);case 6:return t=e.sent,t=(0,n.Z)((0,n.Z)({},t),r),e.next=10,this._reschedule((function(){return a._executeSceneFilterQuery(t,i)}),i);case 10:return s=e.sent,e.next=13,this._reschedule((function(){return a._executeGeometryQuery(t,s,i)}),i);case 13:return u=e.sent,e.next=16,this._reschedule((function(){return a._executeAggregateIdsQuery(u)}),i);case 16:return e.next=18,this._reschedule((function(){return a._executeObjectIdsQuery(u)}),i);case 18:return e.next=20,this._reschedule((function(){return a._executeTimeQuery(u)}),i);case 20:return e.next=22,this._reschedule((function(){return a._executeAttributesQuery(u)}),i);case 22:return e.abrupt("return",u);case 23:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeSceneFilterQuery",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){var n,u,a,o,l,p,h,y,d,m,x,v,g,b,k,w,I,Q,Z=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.Wi)(t.sceneFilter)){e.next=2;break}return e.abrupt("return",null);case 2:if(n=t.outSR,u=t.returnGeometry,a=t.returnCentroid,o=this.featureStore.featureSpatialReference,l=t.sceneFilter.geometry,p=(0,f.Wi)(o)||(0,S.fS)(o,l.spatialReference)?l:(0,_.iV)(l,o)){e.next=5;break}return e.abrupt("return",null);case 5:if(h=u||a,y=(0,S.JY)(n)&&!(0,S.fS)(this.spatialReference,n)&&h?function(){var e=(0,s.Z)(c.mark((function e(t){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Z._project(t,n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}():function(e){return e},d=this.featureAdapter,m=this._searchFeatures(this._getQueryBBoxes(p)),"disjoint"!==t.sceneFilter.spatialRelationship){e.next=19;break}if(m.length){e.next=9;break}return e.abrupt("return",null);case 9:x=new Set,v=(0,i.Z)(m);try{for(v.s();!(g=v.n()).done;)b=g.value,x.add(d.getObjectId(b))}catch(C){v.e(C)}finally{v.f()}return e.next=14,this._reschedule((function(){return Z.featureStore.toArray()}),r);case 14:return k=e.sent,e.next=17,this._reschedule((0,s.Z)(c.mark((function e(){var n,i,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,F.cW)("esriSpatialRelDisjoint",p,Z.geometryType,Z.hasZ,Z.hasM);case 2:return n=e.sent,i=function(e){return!x.has(d.getObjectId(e))||n(d.getGeometry(e))},e.next=6,Z._runSpatialFilter(k,i,r);case 6:return s=e.sent,e.abrupt("return",new R.y(s,t,Z));case 8:case"end":return e.stop()}}),e)}))),r);case 17:return w=e.sent,e.abrupt("return",y(w));case 19:if(m.length){e.next=21;break}return e.abrupt("return",new R.y([],t,this));case 21:if(!this._canExecuteSinglePass(p,t)){e.next=23;break}return e.abrupt("return",y(new R.y(m,t,this)));case 23:return e.next=25,(0,F.cW)("esriSpatialRelContains",p,this.geometryType,this.hasZ,this.hasM);case 25:return I=e.sent,e.next=28,this._runSpatialFilter(m,(function(e){return I(d.getGeometry(e))}),r);case 28:return Q=e.sent,e.abrupt("return",y(new R.y(Q,t,this)));case 30:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_executeGeometryQuery",value:function(){var e=(0,s.Z)(c.mark((function e(t,r,n){var u,a,l,p,h,y,d,m,x,v,g,b,k,w,I,Q,Z,C,A,E,T,G,P,O,q,j=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,f.pC)(r)||0!==r.items.length){e.next=2;break}return e.abrupt("return",r);case 2:if(t=(0,f.pC)(r)?r.query:t,a=(u=t).geometry,l=u.outSR,p=u.spatialRel,h=u.returnGeometry,y=u.returnCentroid,d=this.featureStore.featureSpatialReference,m=!a||(0,f.Wi)(d)||(0,S.fS)(d,a.spatialReference)?a:(0,_.iV)(a,d),x=h||y,v=(0,S.JY)(l)&&!(0,S.fS)(this.spatialReference,l),g=this._geometryQueryCache&&(0,f.Wi)(r)?v&&x?JSON.stringify({originalFilterGeometry:a,spatialRelationship:p,outSpatialReference:l}):JSON.stringify({originalFilterGeometry:a,spatialRelationship:p}):null,b=g?this._geometryQueryCache.get(g):null,!(0,f.pC)(b)){e.next=6;break}return e.abrupt("return",new R.y(b,t,this));case 6:if(k=function(){var e=(0,s.Z)(c.mark((function e(t){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=v&&x,!e.t0){e.next=4;break}return e.next=4,j._project(t,l);case 4:return g&&j._geometryQueryCache.put(g,t.items,t.items.length+1),e.abrupt("return",t);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),m){e.next=9;break}return e.abrupt("return",k((0,f.pC)(r)?r:this._getAll(t)));case 9:if(w=this.featureAdapter,I=this._searchFeatures(this._getQueryBBoxes(a)),"esriSpatialRelDisjoint"!==p){e.next=29;break}if(I.length){e.next=14;break}return e.abrupt("return",k((0,f.pC)(r)?r:this._getAll(t)));case 14:Q=new Set,Z=(0,i.Z)(I);try{for(Z.s();!(C=Z.n()).done;)A=C.value,Q.add(w.getObjectId(A))}catch(M){Z.e(M)}finally{Z.f()}if(!(0,f.pC)(r)){e.next=21;break}e.t0=r.items,e.next=24;break;case 21:return e.next=23,this._reschedule((function(){return j.featureStore.toArray()}),n);case 23:e.t0=e.sent;case 24:return E=e.t0,e.next=27,this._reschedule((0,s.Z)(c.mark((function e(){var r,i,s;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,F.cW)(p,m,j.geometryType,j.hasZ,j.hasM);case 2:return r=e.sent,i=function(e){return!Q.has(w.getObjectId(e))||r(w.getGeometry(e))},e.next=6,j._runSpatialFilter(E,i,n);case 6:return s=e.sent,e.abrupt("return",new R.y(s,t,j));case 8:case"end":return e.stop()}}),e)}))),n);case 27:return T=e.sent,e.abrupt("return",k(T));case 29:if((0,f.pC)(r)&&(G=new o.SO,I=I.filter((function(e){return(0,o.cq)(r.items,e,r.items.length,G)>=0}))),I.length){e.next=33;break}return P=new R.y([],t,this),e.abrupt("return",(g&&this._geometryQueryCache.put(g,P.items,1),P));case 33:if(!this._canExecuteSinglePass(m,t)){e.next=35;break}return e.abrupt("return",k(new R.y(I,t,this)));case 35:return e.next=37,(0,F.cW)(p,m,this.geometryType,this.hasZ,this.hasM);case 37:return O=e.sent,e.next=40,this._runSpatialFilter(I,(function(e){return O(w.getGeometry(e))}),n);case 40:return q=e.sent,e.abrupt("return",k(new R.y(q,t,this)));case 42:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_executeAggregateIdsQuery",value:function(e){if(0!==e.items.length&&e.query.aggregateIds&&e.query.aggregateIds.length&&!(0,f.Wi)(this.aggregateAdapter)){var t,r=new Set,n=(0,i.Z)(e.query.aggregateIds);try{for(n.s();!(t=n.n()).done;){var s=t.value;this.aggregateAdapter.getFeatureObjectIds(s).forEach((function(e){return r.add(e)}))}}catch(a){n.e(a)}finally{n.f()}var u=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return r.has(u(e))}))}}},{key:"_executeObjectIdsQuery",value:function(e){if(0!==e.items.length&&e.query.objectIds&&e.query.objectIds.length){var t=new Set(e.query.objectIds),r=this.featureAdapter.getObjectId;e.items=e.items.filter((function(e){return t.has(r(e))}))}}},{key:"_executeTimeQuery",value:function(e){if(0!==e.items.length){var t=(0,I.y)(this.timeInfo,e.query.timeExtent,this.featureAdapter);(0,f.Wi)(t)||(e.items=e.items.filter(t))}}},{key:"_executeAttributesQuery",value:function(e){var t=this;if(0!==e.items.length){var r=(0,k.Jc)(e.query.where,this.fieldsIndex);if(r){if(!r.isStandardized)throw new TypeError("Where clause is not standardized");e.items=e.items.filter((function(e){return r.testFeature(e,t.featureAdapter)}))}}}},{key:"_runSpatialFilter",value:function(){var e=(0,s.Z)(c.mark((function e(t,r,n){var i,u,a,o=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return",t);case 2:if(!(0,f.Wi)(this._frameTask)){e.next=4;break}return e.abrupt("return",t.filter((function(e){return r(e)})));case 4:return i=0,u=new Array,a=function(){var e=(0,s.Z)(c.mark((function e(s){var l;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i<t.length)){e.next=9;break}if(l=t[i++],r(l)&&(u.push(l),s.madeProgress()),e.t0=s.done,!e.t0){e.next=7;break}return e.next=7,o._reschedule((function(e){return a(e)}),n);case 7:e.next=0;break;case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),e.abrupt("return",this._reschedule((function(e){return a(e)}),n).then((function(){return u})));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_filterLatest",value:function(e){var t,r=this.timeInfo,n=r.trackIdField,s=r.startTimeField,u=r.endTimeField||s,a=new Map,c=this.featureAdapter.getAttribute,o=(0,i.Z)(e.items);try{for(o.s();!(t=o.n()).done;){var l=t.value,p=c(l,n),f=c(l,u),h=a.get(p);(!h||f>c(h,u))&&a.set(p,l)}}catch(y){o.e(y)}finally{o.f()}e.items=Array.from(a.values())}},{key:"_canExecuteSinglePass",value:function(e,t){var r=t.spatialRel;return(0,F.hN)(e)&&("esriSpatialRelEnvelopeIntersects"===r||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===r||"esriSpatialRelContains"===r||"esriSpatialRelWithin"===r))}},{key:"_project",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){var n,i,s=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r&&!(0,S.fS)(this.spatialReference,r)){e.next=2;break}return e.abrupt("return",t);case 2:return n=this.featureAdapter,e.next=5,(0,_.oj)(t.items.map((function(e){return(0,Q.Op)(s.geometryType,s.hasZ,s.hasM,n.getGeometry(e))})),this.spatialReference,r);case 5:return i=e.sent,e.abrupt("return",(t.items=i.map((function(e,r){return n.cloneWithGeometry(t.items[r],(0,b.GH)(e,s.hasZ,s.hasM))})),t));case 7:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getQueryBBoxes",value:function(e){if((0,F.hN)(e)){if((0,v.YX)(e))return[(0,m.al)(e.xmin,e.ymin,e.xmax,e.ymax)];if((0,v.oU)(e))return e.rings.map((function(e){return(0,m.al)(Math.min(e[0][0],e[2][0]),Math.min(e[0][1],e[2][1]),Math.max(e[0][0],e[2][0]),Math.max(e[0][1],e[2][1]))}))}return[(0,x.$P)((0,m.Ue)(),e)]}},{key:"_searchFeatures",value:function(e){var t,r=(0,i.Z)(e);try{for(r.s();!(t=r.n()).done;){var n=t.value;this.featureStore.forEachInBounds(n,(function(e){return j.add(e)}))}}catch(u){r.e(u)}finally{r.f()}var s=Array.from(j.values());return j.clear(),s}},{key:"_checkStatisticsSupport",value:function(){var e=(0,s.Z)(c.mark((function e(t,r){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text||t.outStatistics||t.groupByFieldsForStatistics||t.having||t.orderByFields)){e.next=2;break}throw new l.Z(E,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),Promise.all([this._checkStatisticsParamsSupport(r),(0,F.P0)(t,this.geometryType,this.spatialReference),(0,_._W)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_checkStatisticsParamsSupport",value:function(){var e=(0,s.Z)(c.mark((function e(t){var r,n,i;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!t.valueExpression){e.next=7;break}return e.next=4,(0,C.LC)();case 4:n=e.sent,i=n.arcadeUtils,r=i.extractFieldNames(t.valueExpression);case 7:if(t.field&&r.push(t.field),t.normalizationField&&r.push(t.normalizationField),r.length){e.next=9;break}throw new l.Z(E,"params should have at least a field or valueExpression",{params:t});case 9:(0,k.Of)(this.fieldsIndex,r,"params contains missing fields");case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkQuerySupport",value:function(){var e=(0,s.Z)(c.mark((function e(t){return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.distance<0||null!=t.geometryPrecision||t.multipatchOption||t.pixelSize||t.relationParam||t.text)){e.next=2;break}throw new l.Z(E,"Unsupported query options",{query:t});case 2:return e.abrupt("return",(this._checkAttributesQuerySupport(t),this._checkStatisticsQuerySupport(t),Promise.all([(0,F.P0)(t,this.geometryType,this.spatialReference),(0,_._W)(this.spatialReference,t.outSR)]).then((function(){return t}))));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkAttributesQuerySupport",value:function(e){var t=e.outFields,r=e.orderByFields,n=e.returnDistinctValues,i=e.outStatistics,s=i?i.map((function(e){return e.outStatisticFieldName&&e.outStatisticFieldName.toLowerCase()})).filter(Boolean):[];if(r&&r.length>0){var u=" asc",a=" desc",c=r.map((function(e){var t=e.toLowerCase();return t.includes(u)?t.split(u)[0]:t.includes(a)?t.split(a)[0]:e})).filter((function(e){return!s.includes(e)}));(0,k.Of)(this.fieldsIndex,c,"orderByFields contains missing fields")}if(t&&t.length>0)(0,k.Of)(this.fieldsIndex,t,"outFields contains missing fields");else if(n)throw new l.Z(E,"outFields should be specified for returnDistinctValues",{query:e});(0,k.hO)(this.fieldsIndex,e.where)}},{key:"_checkStatisticsQuerySupport",value:function(e){var t=e.outStatistics,r=e.groupByFieldsForStatistics,n=e.having,s=r&&r.length,u=t&&t.length;if(n){if(!s||!u)throw new l.Z(E,"outStatistics and groupByFieldsForStatistics should be specified with having",{query:e});(0,k.z4)(this.fieldsIndex,n,t)}if(u){if(!function(e){return e.every((function(e){return"exceedslimit"!==e.statisticType}))}(t))return;var a=t.map((function(e){return e.onStatisticField})).filter(Boolean);(0,k.Of)(this.fieldsIndex,a,"onStatisticFields contains missing fields"),s&&(0,k.Of)(this.fieldsIndex,r,"groupByFieldsForStatistics contains missing fields");var c,o=(0,i.Z)(t);try{for(o.s();!(c=o.n()).done;){var p=c.value,f=p.onStatisticField,h=p.statisticType;if("percentile_disc"!==h&&"percentile_cont"!==h||!("statisticParameters"in p)){if("count"!==h&&f&&(0,k.G3)(f,this.fieldsIndex))throw new l.Z(E,"outStatistics contains non-numeric fields",{definition:p,query:e})}else if(!p.statisticParameters)throw new l.Z(E,"statisticParamters should be set for percentile type",{definition:p,query:e})}}catch(y){o.e(y)}finally{o.f()}}}},{key:"_getQueryEngineResultForStats",value:function(){var e=(0,s.Z)(c.mark((function e(t,r,n){var i,s,u=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,p.d9)(t),e.prev=1,e.next=4,this._schedule((function(){return(0,Q.Up)(t,u.definitionExpression,u.spatialReference)}),n);case 4:return t=e.sent,e.next=7,this._reschedule((function(){return u._checkStatisticsSupport(t,r)}),n);case 7:return t=e.sent,e.next=10,this._reschedule((function(){return u._executeSceneFilterQuery(t,n)}),n);case 10:return i=e.sent,e.next=13,this._reschedule((function(){return u._executeGeometryQuery(t,i,n)}),n);case 13:return s=e.sent,e.next=16,this._reschedule((function(){return u._executeAggregateIdsQuery(s)}),n);case 16:return e.next=18,this._reschedule((function(){return u._executeObjectIdsQuery(s)}),n);case 18:return e.next=20,this._reschedule((function(){return u._executeTimeQuery(s)}),n);case 20:return e.next=22,this._reschedule((function(){return u._executeAttributesQuery(s)}),n);case 22:return e.abrupt("return",s);case 25:if(e.prev=25,e.t0=e.catch(1),e.t0===Q.vF){e.next=29;break}throw e.t0;case 29:return e.abrupt("return",new R.y([],t,this));case 30:case"end":return e.stop()}}),e,this,[[1,25]])})));return function(t,r,n){return e.apply(this,arguments)}}()}]),e}(),O=(0,d.Ue)(),q=(0,d.Ue)(),j=new Set},97615:function(e,t,r){r.d(t,{g:function(){return n}});var n={supportsStatistics:!0,supportsPercentileStatistics:!0,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsCentroid:!0,supportsCacheHint:!1,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsQuantizationEditMode:!1,supportsQueryGeometry:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsMaxRecordCountFactor:!1,supportsStandardizedQueriesOnly:!0,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!0,supportsDefaultSpatialReference:!1,supportsCompactGeometry:!1,maxRecordCountFactor:void 0,maxRecordCount:void 0,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0}},20881:function(e,t,r){r.d(t,{hN:function(){return C},P0:function(){return Q},cW:function(){return I}});var n=r(37762),i=r(15861),s=r(87757),u=r(77284),a=r(86749),c=r(51673);var o=r(685),l=r(94613);function p(e,t){return e?t?4:3:t?3:2}function f(e,t,r,n,i,s){var u=p(i,s),a=n.coords,c=n.lengths;if(!c)return!1;for(var o=0,l=0;o<c.length;o++,l+=u)if(!h(e,t,r,a[l],a[l+1]))return!1;return!0}function h(e,t,r,i,s){if(!e)return!1;var u,a=p(t,r),c=e.coords,o=e.lengths,l=!1,f=0,h=(0,n.Z)(o);try{for(h.s();!(u=h.n()).done;){var d=u.value;l=y(l,c,a,f,d,i,s),f+=d*a}}catch(m){h.e(m)}finally{h.f()}return l}function y(e,t,r,n,i,s,u){for(var a=e,c=n,o=n,l=n+i*r;o<l;o+=r){(c=o+r)===l&&(c=n);var p=t[o],f=t[o+1],h=t[c],y=t[c+1];(f<u&&y>=u||y<u&&f>=u)&&p+(u-f)/(y-f)*(h-p)<s&&(a=!a)}return a}var d=r(90289),m=r(52300),x=r(85817),v=r(45371),g="feature-store:unsupported-query",S={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},b={esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},k={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},_={esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1};function w(e){return!0===b[e]}function R(e){return!0===k[(0,o.Ji)(e)]}function F(e){return!0===_[e]}function I(e,t,n,i,s){if((0,o.oU)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){var u=(0,d.Uy)(new m.Z,t,!1,!1);return Promise.resolve((function(e){return function(e,t,r,n){return h(e,t,r,n.coords[0],n.coords[1])}(u,!1,!1,e)}))}if((0,o.oU)(t)&&"esriGeometryMultipoint"===n){var l=(0,d.Uy)(new m.Z,t,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((function(e){return f(l,!1,!1,e,i,s)}))}if((0,o.YX)(t)&&"esriGeometryPoint"===n&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((function(e){return(0,a.aV)(t,(0,v.Op)(n,i,s,e))}));if((0,o.YX)(t)&&"esriGeometryMultipoint"===n&&"esriSpatialRelContains"===e)return Promise.resolve((function(e){return(0,a.lQ)(t,(0,v.Op)(n,i,s,e))}));if((0,o.YX)(t)&&"esriSpatialRelIntersects"===e){var p=function(e){return"mesh"===e?c.h_:(0,c.IY)(e)}(n);return Promise.resolve((function(e){return p(t,(0,v.Op)(n,i,s,e))}))}return Promise.all([r.e(5033),r.e(4670)]).then(r.bind(r,44670)).then((function(r){var u=r[S[e]].bind(null,t.spatialReference,t);return function(e){return u((0,v.Op)(n,i,s,e))}}))}function Q(e,t,r){return Z.apply(this,arguments)}function Z(){return Z=(0,i.Z)(s.mark((function e(t,r,n){var i,a;return s.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t.spatialRel,!(a=t.geometry)){e.next=11;break}if(w(i)){e.next=4;break}throw new u.Z(g,"Unsupported query spatial relationship",{query:t});case 4:if(!(0,l.JY)(a.spatialReference)||!(0,l.JY)(n)){e.next=11;break}if(R(a)){e.next=7;break}throw new u.Z(g,"Unsupported query geometry type",{query:t});case 7:if(F(r)){e.next=9;break}throw new u.Z(g,"Unsupported layer geometry type",{query:t});case 9:if(!t.outSR){e.next=11;break}return e.abrupt("return",(0,x._W)(t.geometry&&t.geometry.spatialReference,t.outSR));case 11:case"end":return e.stop()}}),e)}))),Z.apply(this,arguments)}function C(e){if((0,o.YX)(e))return!0;if((0,o.oU)(e)){var t,r=(0,n.Z)(e.rings);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(5!==i.length)return!1;if(i[0][0]!==i[1][0]||i[0][0]!==i[4][0]||i[2][0]!==i[3][0]||i[0][1]!==i[3][1]||i[0][1]!==i[4][1]||i[1][1]!==i[2][1])return!1}}catch(s){r.e(s)}finally{r.f()}return!0}return!1}},27889:function(e,t,r){function n(e,t){if(!e)return null;var r=t.featureAdapter,n=e.startTimeField,i=e.endTimeField,s=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY;if(n&&i)t.forEach((function(e){var t=r.getAttribute(e,n),a=r.getAttribute(e,i);null==t||isNaN(t)||(s=Math.min(s,t)),null==a||isNaN(a)||(u=Math.max(u,a))}));else{var a=n||i;t.forEach((function(e){var t=r.getAttribute(e,a);null==t||isNaN(t)||(s=Math.min(s,t),u=Math.max(u,t))}))}return{start:s,end:u}}function i(e,t,r){if(!t||!e)return null;var n=e.startTimeField,i=e.endTimeField;if(!n&&!i)return null;var s=t.start,u=t.end;return null===s&&null===u?null:void 0===s&&void 0===u?function(){return!1}:n&&i?function(e,t,r,n,i){return null!=n&&null!=i?function(s){var u=e.getAttribute(s,t),a=e.getAttribute(s,r);return(null==u||u<=i)&&(null==a||a>=n)}:null!=n?function(t){var i=e.getAttribute(t,r);return null==i||i>=n}:null!=i?function(r){var n=e.getAttribute(r,t);return null==n||n<=i}:void 0}(r,n,i,s,u):function(e,t,r,n){return null!=r&&null!=n&&r===n?function(n){return e.getAttribute(n,t)===r}:null!=r&&null!=n?function(i){var s=e.getAttribute(i,t);return s>=r&&s<=n}:null!=r?function(n){return e.getAttribute(n,t)>=r}:null!=n?function(r){return e.getAttribute(r,t)<=n}:void 0}(r,n||i,s,u)}r.d(t,{R:function(){return n},y:function(){return i}})}}]);