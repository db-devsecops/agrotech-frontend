"use strict";(self.webpackChunkagrotech_frontend=self.webpackChunkagrotech_frontend||[]).push([[5565],{55565:function(e,t,r){r.r(t),r.d(t,{default:function(){return st}});var n=r(15861),i=r(1413),a=r(15671),s=r(43144),o=r(11752),l=r(61120),u=r(60136),c=r(29388),f=r(87757),h=r(98248),p=r(5034),d=r(47221),m=r(77284),v=r(77822),y=r(9182),x=r(71453),g=r(27970),b=r(35569),k=(r(59537),r(65343)),w=r(61340),I=r(92167),_=r(96326),C=r(48916),S=r(79143),T=r(32387),Z=r(51767),R=r(29439),M=(r(32224),r(86755)),P=r(84615),O=r(94599),B=r(94613),F=r(86043),z=r(2798),D=r(36041),E=r(87235),A=r(13996),N=r(10777),L=r(88708),H=r(98517),W=r(27488),J=r(19242),j=r(13179),q=r(26208),G=P.Z.getLogger("esri.layers.mixins.ImageryTileMixin"),U=r(4405),V=r(5900),X=r(15976),Y=r(47004),K=r(56970),Q=r(2892),$=r(39322),ee=r(87855),te=r(79305),re=r(93433),ne=r(8410),ie=r(33782),ae=r(77678),se=r(16370),oe=r(12913),le=r(17445),ue=r(3717),ce=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).rasterJobHandler=null,e.datasetName=null,e.datasetFormat=null,e.rasterInfo=null,e.ioConfig={sampling:"closest"},e}return(0,s.Z)(r,[{key:"init",value:function(){var e=(0,n.Z)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(0,le.zD)(),this.addResolvingPromise(t),e.next=4,this.when();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"normalizeCtorArgs",value:function(e){return e&&e.ioConfig&&(e=(0,i.Z)((0,i.Z)({},e),{},{ioConfig:(0,i.Z)({resolution:null,bandIds:null,sampling:"closest",tileInfo:A.Z.create()},e.ioConfig)})),e}},{key:"_isGlobalWrappableSource",get:function(){var e=this.rasterInfo,t=(0,le.ut)(e.spatialReference);return(0,v.pC)(t)&&e.extent.width>=t/2}},{key:"url",set:function(e){this._set("url",(0,F.Nm)(e,P.Z.getLogger(this.declaredClass)))}},{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new m.Z("BaseRaster:open-not-implemented","open() is not implemented");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchTile",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=o.length>3&&void 0!==o[3]?o[3]:{},a=i.tileInfo||this.rasterInfo.storageInfo.tileInfo,s=this.getTileExtentFromTileInfo(t,r,n,a),e.abrupt("return",this.fetchPixels(s,a.size[0],a.size[1],i));case 3:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"identify",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_,C,S,T,Z,R,M,P,O,B,F,z,D=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=D.length>1&&void 0!==D[1]?D[1]:{},o=(s=a).multidimensionalDefinition,l=s.timeExtent,u=this.rasterInfo,c=u.hasMultidimensionalTranspose,h=u.multidimensionalInfo,p=a.transposedVariableName,(d=(0,v.pC)(h)&&c&&(null!=l||(0,N.WU)(o)))&&!p&&(p=(0,v.pC)(o)&&o.length>0?o[0].variableName:h.variables[0].name,a=(0,i.Z)((0,i.Z)({},a),{},{transposedVariableName:p})),a=this._getRequestOptionsWithSliceId(a),m=this.rasterInfo,y=m.spatialReference,x=m.extent,g=a.datumTransformation,b=(0,le.nF)(t,y,g),x.intersects(b)){e.next=10;break}return e.abrupt("return",{location:b,value:null});case 10:if(!(0,v.pC)(this.rasterInfo.transform)){e.next=15;break}if(k=this.rasterInfo.transform.inverseTransform(b),this.rasterInfo.nativeExtent.intersects(k)){e.next=14;break}return e.abrupt("return",{location:k,value:null});case 14:b=k;case 15:if(w=0,I=p&&(0,v.pC)(h)&&this.rasterInfo.hasMultidimensionalTranspose){e.next=27;break}if(!a.srcResolution){e.next=22;break}w=(0,le.kr)(a.srcResolution,this.rasterInfo,this.ioConfig.sampling).pyramidLevel,e.next=27;break;case 22:return e.next=24,this.computeBestPyramidLevelForLocation(t,a);case 24:if(null!=(w=e.sent)){e.next=27;break}return e.abrupt("return",{location:b,value:null});case 27:if(null!==(_=this.identifyPixelLocation(b,w,null,I))){e.next=30;break}return e.abrupt("return",{location:b,value:null});case 30:return C=_.row,S=_.col,T=_.rowOffset,Z=_.colOffset,R=_.blockWidth,M=null!==(r=p)&&void 0!==r?r:(0,v.Wg)(a.sliceId),P=(0,ae.Rq)(this.url,M),O="".concat(w,"/").concat(C,"/").concat(S),B=(0,ae.Qg)(P,null,O),(0,v.Wi)(B)&&(B=this.fetchRawTile(w,C,S,a),(0,ae.gX)(P,null,O,B)),e.next=35,B;case 35:if(F=e.sent,!(0,v.Wi)(F)&&null!==(n=F.pixels)&&void 0!==n&&n.length){e.next=38;break}return e.abrupt("return",{location:b,value:null});case 38:return z=T*R+Z,e.abrupt("return",this._processIdentifyResult(F,{srcLocation:b,position:z,pyramidLevel:w,useTransposedTile:I,requestSomeSlices:d,identifyOptions:a}));case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchPixels",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=_.length>3&&void 0!==_[3]?_[3]:{},t=(0,le.kZ)(t),!(i=this._getRequestOptionsWithSliceId(i)).requestRawData){e.next=3;break}return e.abrupt("return",this._fetchPixels(t,r,n,i));case 3:if(a=(0,le.ut)(t.spatialReference),s=(0,le.Hq)(t),!((0,v.Wi)(a)||0===s||1===s&&this._isGlobalWrappableSource)){e.next=6;break}return e.abrupt("return",this._fetchPixels(t,r,n,i));case 6:if(!(s>=3)){e.next=8;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 8:for(o=[],u=(l=t).xmin,c=l.xmax,h=Math.round(a/(c-u)*r),p=h-Math.round((a/2-u)/(c-u)*r),d=0,m=[],y=0;y<=s;y++)x=new j.Z({xmin:0===y?u:-a/2,xmax:y===s?c-a*y:a/2,ymin:t.ymin,ymax:t.ymax,spatialReference:t.spatialReference}),d+=g=0===y?h-p:y===s?r-d:h,m.push(g),b=i.disableWrapAround&&y>0?null:this._fetchPixels(x,g,n,i),o.push(b);return e.next=14,Promise.all(o);case 14:if(k=e.sent.map((function(e){return null===e||void 0===e?void 0:e.pixelBlock})),w=null,I={width:r,height:n},!this.rasterJobHandler){e.next=23;break}return e.next=20,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:k,srcMosaicSize:I,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:m},i);case 20:w=e.sent.pixelBlock,e.next=24;break;case 23:w=(0,oe.us)(k,I,{blockWidths:m});case 24:return e.abrupt("return",{extent:t,srcExtent:(0,le.tB)(t,this.rasterInfo.spatialReference,i.datumTransformation),pixelBlock:w});case 25:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchRawPixels",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=w.length>3&&void 0!==w[3]?w[3]:{},r={x:Math.floor(r.x),y:Math.floor(r.y)},e.next=4,this._fetchRawTiles(t,r,n,i);case 4:if(a=e.sent,s=this.rasterInfo,o=s.nativeExtent,l=s.nativePixelSize,u=s.storageInfo,c=Math.pow(2,t),h=l.x*c,p=l.y*c,d=new j.Z({xmin:o.xmin+h*r.x,xmax:o.xmin+h*(r.x+n.width-1),ymin:o.ymax-p*(r.y+n.height-1),ymax:o.ymax-p*r.y,spatialReference:o.spatialReference}),a){e.next=15;break}return e.abrupt("return",{extent:d,srcExtent:d,pixelBlock:null});case 15:if(m=a.pixelBlocks,y=a.mosaicSize,1!==m.length||!(0,v.pC)(m[0])||m[0].width!==n.width||m[0].height!==n.height){e.next=18;break}return e.abrupt("return",{extent:d,srcExtent:d,pixelBlock:a.pixelBlocks[0]});case 18:if(x=t>0?u.pyramidBlockWidth:u.blockWidth,g=t>0?u.pyramidBlockHeight:u.blockHeight,b={x:r.x%x,y:r.y%g},!this.rasterJobHandler){e.next=25;break}return e.next=22,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:m,srcMosaicSize:y,destDimension:n,clipOffset:b,clipSize:n,coefs:null,sampleSpacing:null,interpolation:i.interpolation,alignmentInfo:null,blockWidths:null},i);case 22:k=e.sent.pixelBlock,e.next=26;break;case 25:k=(0,oe.us)(m,y,{clipOffset:b,clipSize:n});case 26:return e.abrupt("return",{extent:d,srcExtent:d,pixelBlock:k});case 27:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(e,t,r,n){throw new m.Z("BaseRaster:read-not-implemented","fetchRawTile() is not implemented")}},{key:"computeExtent",value:function(e){return(0,le.tB)(this.rasterInfo.extent,e)}},{key:"decodePixelBlock",value:function(e,t){return!this.rasterJobHandler||t.useCanvas?(0,se.J)(e,t):this.rasterJobHandler.decode({data:e,options:t})}},{key:"request",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var a,s,o,l,u,c,h;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=this.ioConfig.customFetchParameters,l=r.range,u=r.query,c=r.headers,n=null!==(a=null!==(s=n)&&void 0!==s?s:r.retryCount)&&void 0!==a?a:this.ioConfig.retryCount,h=l?{Range:"bytes=".concat(l.from,"-").concat(l.to)}:null,e.prev=3,e.next=6,(0,M.default)(t,(0,i.Z)((0,i.Z)({},r),{},{query:(0,i.Z)((0,i.Z)({},u),o),headers:(0,i.Z)((0,i.Z)({},c),h)}));case 6:return e.abrupt("return",e.sent);case 9:if(e.prev=9,e.t0=e.catch(3),!(n>0)){e.next=13;break}return e.abrupt("return",(n--,this.request(t,r,n)));case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,this,[[3,9]])})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getSliceIndex",value:function(e){var t=this.rasterInfo.multidimensionalInfo;return(0,v.Wi)(t)||(0,v.Wi)(e)||0===e.length?null:(0,N.gk)(e,t)}},{key:"getTileExtentFromTileInfo",value:function(e,t,r,n){var i=n.lodAt(e);return this.getTileExtent({x:i.resolution,y:i.resolution},t,r,n.origin,n.spatialReference,n.size)}},{key:"updateTileInfo",value:function(){var e=this.rasterInfo,t=e.storageInfo,r=e.spatialReference,n=e.extent,i=e.pixelSize;if(!t.tileInfo){for(var a=[],s=t.maximumPyramidLevel||0,o=Math.max(i.x,i.y),l=1/.0254*96*o,u=0;u<=s;u++)a.push({level:s-u,resolution:o,scale:l}),o*=2,l*=2;var c=new ue.Z({x:n.xmin,y:n.ymax,spatialReference:r});t.tileInfo=new A.Z({origin:c,size:[t.blockWidth,t.blockHeight],spatialReference:r,lods:a}),t.isVirtualTileInfo=!0}}},{key:"createRemoteDatasetStorageInfo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:512,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,n=arguments.length>3?arguments[3]:void 0,i=e.width,a=e.height,s=e.nativeExtent,o=e.pixelSize,l=e.spatialReference,u=new ue.Z({x:s.xmin,y:s.ymax,spatialReference:l});null==n&&(n=Math.max(0,Math.round(Math.log(Math.max(i,a))/Math.LN2-8)));var c=this.computeBlockBoundary(s,512,512,{x:s.xmin,y:s.ymax},[o],n);e.storageInfo=new te.Z({blockWidth:t,blockHeight:r,pyramidBlockWidth:t,pyramidBlockHeight:r,origin:u,firstPyramidLevel:1,maximumPyramidLevel:n,blockBoundary:c})}},{key:"computeBestPyramidLevelForLocation",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",0);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"computeBlockBoundary",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2;if(1===i.length&&a>0)for(var o=(i=(0,re.Z)(i))[0],l=o.x,u=o.y,c=0;c<a;c++)l*=s,u*=s,i.push({x:l,y:u});for(var f=[],h=n.x,p=n.y,d=0;d<i.length;d++){var m=i[d],v=m.x,y=m.y;f.push({minCol:Math.floor((e.xmin-h+.1*v)/t/v),maxCol:Math.floor((e.xmax-h-.1*v)/t/v),minRow:Math.floor((p-e.ymax+.1*y)/r/y),maxRow:Math.floor((p-e.ymin-.1*y)/r/y)})}return f}},{key:"getPyramidPixelSize",value:function(e){var t=this.rasterInfo.nativePixelSize,r=this.rasterInfo.storageInfo,n=r.pyramidResolutions,i=r.pyramidScalingFactor;if(0===e)return t;if((0,v.pC)(n)&&n.length)return n[e-1];var a=Math.pow(i,e);return{x:t.x*a,y:t.y*a}}},{key:"identifyPixelLocation",value:function(e,t,r,n){var i=this.rasterInfo,a=i.spatialReference,s=i.nativeExtent,o=i.storageInfo,l=o.maximumPyramidLevel,u=o.origin,c=o.transposeInfo,f=n&&(0,v.pC)(c)?c.tileSize[0]:o.blockWidth,h=n&&(0,v.pC)(c)?c.tileSize[1]:o.blockHeight,p=(0,le.nF)(e,a,r);if(!s.intersects(p))return null;if(t<0||t>l)return null;var d=this.getPyramidPixelSize(t),m=d.x,y=d.y,x=(u.y-p.y)/y/h,g=(p.x-u.x)/m/f,b=Math.min(h-1,Math.floor((x-Math.floor(x))*h)),k=Math.min(f-1,Math.floor((g-Math.floor(g))*f));return{pyramidLevel:t,row:Math.floor(x),col:Math.floor(g),rowOffset:b,colOffset:k,blockWidth:f,srcLocation:p}}},{key:"getTileExtent",value:function(e,t,r,n,i,a){var s=(0,R.Z)(a,2),o=s[0],l=s[1],u=n.x+r*o*e.x,c=u+o*e.x,f=n.y-t*l*e.y,h=f-l*e.y;return new j.Z({xmin:u,xmax:c,ymin:h,ymax:f,spatialReference:i})}},{key:"getBlockWidthHeight",value:function(e){return{blockWidth:e>0?this.rasterInfo.storageInfo.pyramidBlockWidth:this.rasterInfo.storageInfo.blockWidth,blockHeight:e>0?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}}},{key:"isBlockOutside",value:function(e,t,r){var n=this.rasterInfo.storageInfo.blockBoundary[e];return!n||n.maxRow<t||n.maxCol<r||n.minRow>t||n.minCol>r}},{key:"_fetchPixels",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_,C,S,T,Z,R,M,P,O,B,F,z,D,E,A,N,H=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=H.length>3&&void 0!==H[3]?H[3]:{},!((a=(0,le.Hq)(t))>=2)){e.next=4;break}return e.abrupt("return",{extent:t,pixelBlock:null});case 4:if(s=this._getSourceDataInfo(t,r,n,i),o=s.pyramidLevel,l=s.pyramidResolution,u=s.srcResolution,c=s.srcExtent,h=s.srcWidth,p=s.srcHeight,0!==h&&0!==p){e.next=7;break}return e.abrupt("return",{extent:t,srcExtent:c,pixelBlock:null});case 7:return d=(0,v.Wg)(this.rasterInfo.transform),m="gcs-shift"===(null===d||void 0===d?void 0:d.type),y=(0,v.pC)((0,le.ut)(t.spatialReference)),!m&&y||(a=(0,le.Hq)(s.srcExtent,m)),x=this.rasterInfo.storageInfo,g={x:Math.floor((c.xmin-x.origin.x)/l.x+.1),y:Math.floor((x.origin.y-c.ymax)/l.y+.1)},e.next=13,this._fetchRawTiles(o,g,{width:h,height:p,wrapCount:a},i);case 13:if(b=e.sent){e.next=16;break}return e.abrupt("return",{extent:t,srcExtent:c,pixelBlock:null});case 16:if(k=o>0?x.pyramidBlockWidth:x.blockWidth,w=o>0?x.pyramidBlockHeight:x.blockHeight,I=k===h&&w===p&&g.x%k==0&&g.y%w==0,_=new ue.Z({x:(t.xmax-t.xmin)/r,y:(t.ymax-t.ymin)/n,spatialReference:t.spatialReference}),C=!t.spatialReference.equals(this.rasterInfo.spatialReference),S=i.datumTransformation,C||!I||1!==b.pixelBlocks.length||k!==r||w!==n||u.x!==_.x||u.y!==_.y){e.next=19;break}return e.abrupt("return",{extent:t,srcExtent:c,pixelBlock:b.pixelBlocks[0]});case 19:if(T=y&&(0,v.pC)((0,le.ut)(c.spatialReference)),Z=i.requestProjectedLocalDirections&&this.rasterInfo.dataType.startsWith("vector"),e.t0=Z&&!this.rasterJobHandler,!e.t0){e.next=24;break}return e.next=24,(0,le.zD)();case 24:if(!this.rasterJobHandler){e.next=30;break}return e.next=27,this.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:t,srcBufferExtent:b.extent,pixelSize:_.toJSON(),datumTransformation:S,rasterTransform:d,hasWrapAround:a>0||T,isAdaptive:!1!==this.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:Z},i);case 27:e.t1=e.sent,e.next=31;break;case 30:e.t1=(0,le.Qp)({projectedExtent:t,srcBufferExtent:b.extent,pixelSize:_,datumTransformation:S,rasterTransform:d,hasWrapAround:a>0||T,isAdaptive:!1,includeGCSGrid:Z});case 31:if(R=e.t1,P=!i.requestRawData,O={rows:R.spacing[0],cols:R.spacing[1]},B=(0,v.Wg)(this._getRasterTileAlignmentInfo(o,b.extent.xmin)),F=b.pixelBlocks,z=b.mosaicSize,D=b.isPartiallyFilled,E=null,!this.rasterJobHandler){e.next=42;break}return e.next=37,this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:F,srcMosaicSize:z,destDimension:P?{width:r,height:n}:null,coefs:P?R.coefficients:null,sampleSpacing:P?O:null,projectDirections:Z,gcsGrid:Z?R.gcsGrid:null,isUV:"vector-uv"===this.rasterInfo.dataType,interpolation:i.interpolation,alignmentInfo:B,blockWidths:null},i);case 37:A=e.sent,M=A.pixelBlock,E=A.localNorthDirections,e.next=44;break;case 42:N=(0,oe.us)(F,z,{alignmentInfo:B}),M=P?(0,oe.Uk)(N,{width:r,height:n},R.coefficients,O,i.interpolation):N,Z&&R.gcsGrid&&(E=(0,oe.Qh)({width:r,height:n},R.gcsGrid),M=(0,L.xQ)(M,this.rasterInfo.dataType,E));case 44:return e.abrupt("return",i.requestRawData||Z?{srcExtent:c,pixelBlock:M,transformGrid:R,localNorthDirections:E,extent:t,isPartiallyFilled:D}:{srcExtent:c,extent:t,pixelBlock:M});case 45:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_fetchRawTiles",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n,i){var a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_,C,S,T,Z,R,M,P,O,B,F,z,D,E,A,N,L,H,W,J=this;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this.rasterInfo.storageInfo,s=a.origin,o=a.blockBoundary,l=this.getBlockWidthHeight(t),u=l.blockWidth,c=l.blockHeight,h=r.x,p=r.y,d=n.width,m=n.height,y=n.wrapCount,x=this._getRasterTileAlignmentInfo(t,0),i.buffer&&(h-=i.buffer.cols,p-=i.buffer.rows,d+=2*i.buffer.cols,m+=2*i.buffer.rows),g=0,b=0,k=0,y&&(0,v.pC)(x)&&(b=x.worldColumnCountFromOrigin,k=x.originColumnOffset,g=x.rightPadding,b*x.blockWidth-g>=h+d&&(g=0)),w=Math.floor(h/u),I=Math.floor(p/c),_=Math.floor((h+d+g-1)/u),C=Math.floor((p+m+g-1)/c),S=o[t]){e.next=9;break}return e.abrupt("return",null);case 9:if(T=S.minRow,Z=S.minCol,R=S.maxCol,M=S.maxRow,0!==y||!(C<T||_<Z||I>M||w>R)){e.next=12;break}return e.abrupt("return",null);case 12:for(P=new Array,O=!1,B=null==this.ioConfig.allowPartialFill?i.allowPartialFill:this.ioConfig.allowPartialFill,F=I;F<=C;F++)for(z=w;z<=_;z++)D=z,!i.disableWrapAround&&y&&(0,v.pC)(x)&&b<=z&&(D=z-b-k),F>=T&&D>=Z&&M>=F&&R>=D?function(){var e=J._fetchRawTile(t,F,D,i);B?P.push(new Promise((function(t){e.then((function(e){return t(e)})).catch((function(){O=!0,t(null)}))}))):P.push(e)}():P.push(null);if(0!==P.length){e.next=18;break}return e.abrupt("return",null);case 18:return e.next=20,Promise.all(P);case 20:return E=e.sent,A={height:(C-I+1)*c,width:(_-w+1)*u},N=this.rasterInfo.spatialReference,L=this.getPyramidPixelSize(t),H=L.x,W=L.y,e.abrupt("return",{extent:new j.Z({xmin:s.x+w*u*H,xmax:s.x+(_+1)*u*H,ymin:s.y-(C+1)*c*W,ymax:s.y-I*c*W,spatialReference:N}),pixelBlocks:E,mosaicSize:A,isPartiallyFilled:O});case 27:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_fetchRawTile",value:function(e,t,r,n){var a=this.rasterInfo.storageInfo.blockBoundary[e];if(!a)return Promise.resolve(null);var s=a.minRow,o=a.minCol,l=a.maxCol,u=a.maxRow;if(t<s||r<o||t>u||r>l)return Promise.resolve(null);var c=(0,ae.Rq)(this.url,n.sliceId),f="".concat(e,"/").concat(t,"/").concat(r),h=(0,ae.Qg)(c,n.registryId,f);if((0,v.Wi)(h)){var p=new AbortController;h=this.fetchRawTile(e,t,r,(0,i.Z)((0,i.Z)({},n),{},{signal:p.signal})),(0,ae.gX)(c,n.registryId,f,h,p),h.catch((function(){return(0,ae.Gc)(c,n.registryId,f)}))}return n.signal&&(0,x.fu)(n,(function(){(0,ae.OE)(c,n.registryId,f)})),h}},{key:"_computeMagDirValues",value:function(e){var t,r=this.rasterInfo,n=r.bandCount,i=r.dataType;if((2!==n||"vector-magdir"!==i)&&"vector-uv"!==i||2!==(null===e||void 0===e?void 0:e.length)||null===(t=e[0])||void 0===t||!t.length)return null;var a=e[0].length;if("vector-magdir"===i){var s=e[1].map((function(e){return(e+360)%360}));return[e[0],s]}for(var o=(0,R.Z)(e,2),l=o[0],u=o[1],c=[],f=[],h=0;h<a;h++){var p=(0,L.Tg)([l[h],u[h]]),d=(0,R.Z)(p,2),m=d[0],v=d[1];c.push(m),f.push(v)}return[c,f]}},{key:"_getRasterTileAlignmentInfo",value:function(e,t){return null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=(0,le.P_)(this.rasterInfo)),(0,v.Wi)(this._rasterTileAlighmentInfo.pyramidsInfo)?null:(0,i.Z)({startX:t,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform},this._rasterTileAlighmentInfo.pyramidsInfo[e])}},{key:"_getSourceDataInfo",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i={datumTransformation:n.datumTransformation,pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};n.srcResolution&&(i.srcResolution=n.srcResolution,this._updateSourceDataInfo(e,i));var a=this.rasterInfo.storageInfo.maximumPyramidLevel||0,s=i.srcWidth,o=i.srcHeight,l=i.pyramidLevel,u=s/t,c=o/r,f=l<a&&u*c>=16;if(f||l===a&&(u>8||c>8)||0===s||0===o){var h=new ue.Z({x:(e.xmax-e.xmin)/t,y:(e.ymax-e.ymin)/r,spatialReference:e.spatialReference}),p=(0,le.VO)(h,this.rasterInfo.spatialReference,e,i.datumTransformation),d=!p||n.srcResolution&&p.x+p.y<n.srcResolution.x+n.srcResolution.y;if(f&&n.srcResolution&&d){var m=Math.round(Math.log(Math.max(u,c))/Math.LN2)-1;if(a-l+3>=m){var v=Math.pow(2,m);p={x:n.srcResolution.x*v,y:n.srcResolution.y*v}}}p&&(i.srcResolution=p,this._updateSourceDataInfo(e,i))}return(i.srcWidth/t>8||i.srcHeight/r>8)&&(i.srcWidth=0,i.srcHeight=0),i}},{key:"_updateSourceDataInfo",value:function(e,t){t.srcWidth=0,t.srcHeight=0;var r=this.rasterInfo.spatialReference,n=t.srcResolution,i=t.datumTransformation,a=(0,le.kr)(n,this.rasterInfo,this.ioConfig.sampling),s=a.pyramidLevel,o=a.pyramidResolution;if(!a.excessiveReading){var l=t.srcExtent||(0,le.tB)(e,r,i);if(null!=l){var u=(0,v.Wg)(this.rasterInfo.transform);u&&(l=u.inverseTransform(l)),t.srcExtent=l;var c=Math.ceil((l.xmax-l.xmin)/o.x-.1),f=Math.ceil((l.ymax-l.ymin)/o.y-.1);t.pyramidLevel=s,t.pyramidResolution=o,t.srcWidth=c,t.srcHeight=f}}}},{key:"_getRequestOptionsWithSliceId",value:function(e){return(0,v.pC)(this.rasterInfo.multidimensionalInfo)&&null==e.sliceId&&(e=(0,i.Z)((0,i.Z)({},e),{},{sliceId:this.getSliceIndex(e.multidimensionalDefinition)})),e}},{key:"_processIdentifyResult",value:function(e,t){var r=t.srcLocation,n=t.position,i=t.pyramidLevel,a=t.useTransposedTile,s=e.pixels[0].length/e.width/e.height;if(e.mask&&!e.mask[n])return{location:r,value:null};var o=this.rasterInfo.multidimensionalInfo;if((0,v.Wi)(o)||!a){var l=e.pixels.map((function(e){return e[n]})),u={location:r,value:l,pyramidLevel:i},c=this._computeMagDirValues(l.map((function(e){return[e]})));return null!==c&&void 0!==c&&c.length&&(u.magdirValue=c.map((function(e){return e[0]}))),u}var f=e.pixels.map((function(e){return Array.prototype.slice.call(e,n*s,n*s+s)})),h=this._computeMagDirValues(f),p=t.requestSomeSlices,d=t.identifyOptions,m=(0,N.MO)(o,d.transposedVariableName);if(p){var y,x=(0,N.Ur)(m,(0,v.Wg)(d.multidimensionalDefinition),(0,v.Wg)(d.timeExtent));f=f.map((function(e){return x.map((function(t){return e[t]}))})),h=null===(y=h)||void 0===y?void 0:y.map((function(e){return x.map((function(t){return e[t]}))})),m=x.map((function(e){return m[e]}))}return{location:r,value:null,dataSeries:m.map((function(e,t){var r,n={value:f.map((function(e){return e[t]})),multidimensionalDefinition:e.multidimensionalDefinition,variableName:e.multidimensionalDefinition[0].variableName,dimensionValues:{}};return null!==(r=h)&&void 0!==r&&r.length&&(n.magdirValue=[h[0][t],h[1][t]]),e.multidimensionalDefinition.forEach((function(e){return n.dimensionValues[e.dimensionName]=e.values[0]})),n})),pyramidLevel:i}}}]),r}((0,ie.v)(ne.wq));(0,h._)([(0,b.Cb)()],ce.prototype,"_rasterTileAlighmentInfo",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],ce.prototype,"_isGlobalWrappableSource",null),(0,h._)([(0,b.Cb)(z.HQ)],ce.prototype,"url",null),(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],ce.prototype,"datasetName",void 0),(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],ce.prototype,"datasetFormat",void 0),(0,h._)([(0,b.Cb)()],ce.prototype,"rasterInfo",void 0),(0,h._)([(0,b.Cb)()],ce.prototype,"ioConfig",void 0),(0,h._)([(0,b.Cb)()],ce.prototype,"sourceJSON",void 0);var fe=ce=(0,h._)([(0,C.j)("esri.layers.support.rasterDatasets.BaseRaster")],ce),he=r(74528);function pe(e){var t=e.fields,r=e.records,n=t.some((function(e){return"oid"===e.name.toLowerCase()}))?"OBJECTID":"OID",i=[{name:n,type:"esriFieldTypeOID",alias:"OID"}].concat(t.map((function(e){return{name:e.name,type:"esriFieldType"+e.typeName,alias:e.name}}))),a=i.map((function(e){return e.name})),s=[],o=0,l=0;return r.forEach((function(e){var t={};for(t[n]=o++,l=1;l<a.length;l++)t[a[l]]=e[l-1];s.push({attributes:t})})),{displayFieldName:"",fields:i,features:s}}var de=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"supportedVersions",get:function(){return[5]}},{key:"parse",value:function(e){var t=new DataView(e),r=3&t.getUint8(0);if(3!==r)return{header:{version:r},recordSet:null};var n,i=t.getUint32(4,!0),a=t.getUint16(8,!0),s=t.getUint16(10,!0),o={version:r,recordCount:i,headerByteCount:a,recordByteCount:s},l=32,u=[],c=[];if(3===r){for(;13!==t.getUint8(l);)n=String.fromCharCode(t.getUint8(l+11)).trim(),u.push({name:(0,he.f)(new Uint8Array(e,l,11)),type:n,typeName:["String","Date","Double","Boolean","String","Integer"][["C","D","F","L","M","N"].indexOf(n)],length:t.getUint8(l+16)}),l+=32;if(l+=1,u.length>0)for(var f=function(){var r=[];32===t.getUint8(l)?(l+=1,u.forEach((function(t){if("C"===t.type)r.push((0,he.f)(new Uint8Array(e,l,t.length)).trim());else if("N"===t.type)r.push(parseInt(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim(),10));else if("F"===t.type)r.push(parseFloat(String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim()));else if("D"===t.type){var n=String.fromCharCode.apply(null,new Uint8Array(e,l,t.length)).trim();r.push(new Date(parseInt(n.substring(0,4),10),parseInt(n.substring(4,6),10)-1,parseInt(n.substring(6,8),10)))}l+=t.length})),c.push(r)):l+=s};c.length<i&&e.byteLength-l>s;)f()}return{header:o,fields:u,records:c,recordSet:pe({fields:u,records:c})}}}]),e}(),me=r(1792),ve=r(43632),ye=new Map;ye.set("int16","esriFieldTypeSmallInteger"),ye.set("int32","esriFieldTypeInteger"),ye.set("int64","esriFieldTypeInteger"),ye.set("float32","esriFieldTypeSingle"),ye.set("float64","esriFieldTypeDouble"),ye.set("text","esriFieldTypeString");var xe=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).storageInfo=null,e.datasetFormat="CRF",e}return(0,s.Z)(r,[{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this.request(this.url+"/conf.json",{signal:null===t||void 0===t?void 0:t.signal});case 4:if(r=e.sent,n=r.data,this._validateHeader(n)){e.next=8;break}throw new m.Z("cloudraster:open","Invalid or unsupported conf.json.");case 8:if(this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),i=this._parseHeader(n),a=i.storageInfo,"thematic"!==(s=i.rasterInfo).dataType){e.next=15;break}return e.next=13,this._fetchAuxiliaryInformation();case 13:o=e.sent,s.attributeTable=o;case 15:this._set("storageInfo",a),this._set("rasterInfo",s),this.ioConfig.retryCount=this.ioConfig.retryCount||0;case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,v,y,x,g,b=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=b.length>3&&void 0!==b[3]?b[3]:{},a=this.rasterInfo.storageInfo.transposeInfo,s=i.transposedVariableName,!((l=(o=!(!a||!s))?0:this.rasterInfo.storageInfo.maximumPyramidLevel-t)<0)){e.next=4;break}return e.abrupt("return",null);case 4:return u=this._buildCacheFilePath(l,r,n,i.multidimensionalDefinition,s),c=this._getIndexRecordFromBundle(r,n,o),e.next=8,this.request(u,{range:{from:0,to:this.storageInfo.headerSize-1},responseType:"array-buffer",signal:i.signal});case 8:if(h=e.sent){e.next=11;break}return e.abrupt("return",null);case 11:if(p=new Uint8Array(h.data),0!==(d=this._getTileEndAndContentType(p,c)).recordSize){e.next=14;break}return e.abrupt("return",null);case 14:return e.next=16,this.request(u,{range:{from:d.position,to:d.position+d.recordSize},responseType:"array-buffer",signal:i.signal});case 16:if(m=e.sent){e.next=19;break}return e.abrupt("return",null);case 19:return v=this._getTileSize(o),y=(0,R.Z)(v,2),x=y[0],g=y[1],e.abrupt("return",this.decodePixelBlock(m.data,{width:x,height:g,planes:null,pixelType:null,returnPixelInterleavedDims:o}));case 21:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_validateHeader",value:function(e){return e&&"RasterInfo"===e.type&&!["origin","extent","geodataXform","LODInfos","blockWidth","blockHeight","bandCount","pixelType","pixelSizeX","pixelSizeY","format","packetSize"].some((function(t){return!e[t]}))}},{key:"_parseHeader",value:function(e){var t,r,n=["u1","u2","u4","u8","s8","u16","s16","u32","s32","f32","f64"][e.pixelType],i=e.bandCount,a=e.histograms,s=e.colormap,o=e.blockWidth,l=e.blockHeight,u=e.firstPyramidLevel,c=e.maximumPyramidLevel,f=e.statistics&&e.statistics.map((function(e){return{min:e.min,max:e.max,avg:e.mean,stddev:e.standardDeviation,median:e.median,mode:e.mode}})),h=e.extent.spatialReference,p=null===(t=e.geodataXform)||void 0===t?void 0:t.spatialReference,d=new q.Z(null!==h&&void 0!==h&&h.wkid||null!==h&&void 0!==h&&h.wkt?h:p),m=new j.Z({xmin:e.extent.xmin,ymin:e.extent.ymin,xmax:e.extent.xmax,ymax:e.extent.ymax,spatialReference:d}),v=new ue.Z({x:e.pixelSizeX,y:e.pixelSizeY,spatialReference:d}),y=Math.round((m.xmax-m.xmin)/v.x),x=Math.round((m.ymax-m.ymin)/v.y),g=this._parseTransform(e.geodataXform),b=g?m:null;g&&(m=g.forwardTransform(m),v.x=(m.xmax-m.xmin)/y,v.y=(m.ymax-m.ymin)/x);var k,w,I,_,C=null!==(r=e.properties)&&void 0!==r?r:{},S=e.format.toLowerCase().replace("cache/",""),T=new ue.Z(e.origin.x,e.origin.y,d);if(s&&s.colors)for(k=[],w=0;w<s.colors.length;w++)I=s.colors[w],_=s.values?s.values[w]:w,k.push([_,255&I,I<<16>>>24,I<<8>>>24,I>>>24]);var Z=e.LODInfos,R=[];for(w=0;w<Z.levels.length;w++)R.push({level:Z.levels[w],resolution:Z.resolutions[w],scale:96/.0254*Z.resolutions[w]});var M=new A.Z({dpi:96,lods:R,format:S,origin:T,size:[o,l],spatialReference:d}),P={recordSize:8,packetSize:e.packetSize,headerSize:e.packetSize*e.packetSize*8+64},O=[{maxCol:Math.ceil(y/o)-1,maxRow:Math.ceil(x/l)-1,minCol:0,minRow:0}],B=2;if(c>0)for(w=0;w<c;w++)O.push({maxCol:Math.ceil(y/B/o)-1,maxRow:Math.ceil(x/B/l)-1,minCol:0,minRow:0}),B*=2;var F=e.mdInfo,z=null;if(F&&C._yxs){var D=C._yxs;z={packetSize:D.PacketSize,tileSize:[D.TileXSize,D.TileYSize]}}return{storageInfo:P,rasterInfo:new ee.Z({width:y,height:x,pixelType:n,bandCount:i,extent:m,nativeExtent:b,transform:g,spatialReference:d,pixelSize:v,keyProperties:C,statistics:f,histograms:a,multidimensionalInfo:F,colormap:k,storageInfo:new te.Z({blockWidth:o,blockHeight:l,pyramidBlockWidth:o,pyramidBlockHeight:l,origin:T,tileInfo:M,transposeInfo:z,firstPyramidLevel:u,maximumPyramidLevel:c,blockBoundary:O})})}}},{key:"_parseTransform",value:function(e){var t,r;if(!(0,me.j)(e))throw new m.Z("cloudraster:open","the data contains unsupported geodata transform types");var n=(0,me.c)(e);if("identity"===n.type)return null;if("polynomial"!==n.type||null===(t=n.forwardCoefficients)||void 0===t||!t.length||null===(r=n.inverseCoefficients)||void 0===r||!r.length)throw new m.Z("cloudraster:open","the data contains unsupported geodata transforms - both forward and inverse coefficients are required currently");return n}},{key:"_fetchAuxiliaryInformation",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.request(this.url+"/conf.vat.json",{signal:t}).then((function(e){return e.data})).catch((function(){return null})),n=this.request(this.url+"/conf.vat.dbf",{responseType:"array-buffer",signal:t}).then((function(e){return e.data})).catch((function(){return null})),e.next=4,Promise.all([r,n]);case 4:return(i=e.sent)[0]&&(s=i[0].fields,o=i[0].values,s&&o&&(s=s.map((function(e){return{type:"OID"===e.name?"esriFieldTypeOID":ye.get(e.type),name:e.name,alias:e.alias||e.name}})),l=o.map((function(e){return{attributes:e}})),s&&o&&(a={fields:s,features:l}))),!a&&i[1]&&(a=de.parse(i[1]).recordSet),e.abrupt("return",ve.default.fromJSON(a));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_buildCacheFilePath",value:function(e,t,r,n,i){var a=this._getPackageSize(!!i),s=Math.floor(t/a)*a,o=Math.floor(r/a)*a,l="R"+this._toHexString4(s)+"C"+this._toHexString4(o),u="L";u+=e>=10?e.toString():"0"+e.toString();var c=this.rasterInfo.multidimensionalInfo,f=null===n||void 0===n?void 0:n[0];if((0,v.Wi)(c)||!f)return"".concat(this.url,"/_alllayers/").concat(u,"/").concat(l,".bundle");var h="_yxs";if(!i){h=c.variables.find((function(e){return e.name===f.variableName})).dimensions[0].values.indexOf(f.values[0]).toString(16);for(var p=4-h.length,d=0;d<p;d++)h="0"+h;h="S"+h}var m=this._getVariableFolderName(i||f.variableName);return"".concat(this.url,"/_alllayers/").concat(m,"/").concat(h,"/").concat(u,"/").concat(l,".bundle")}},{key:"_getPackageSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.rasterInfo.storageInfo.transposeInfo;return e&&(0,v.pC)(t)?t.packetSize:this.storageInfo.packetSize}},{key:"_getTileSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.rasterInfo.storageInfo,r=t.transposeInfo;return e&&(0,v.pC)(r)?r.tileSize:t.tileInfo.size}},{key:"_getVariableFolderName",value:function(e){return""===(e=e.trim())?"_v":e.replace(/[\{|\}\-]/g,"_").replace("\\*","_v")}},{key:"_getIndexRecordFromBundle",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this._getPackageSize(r),i=n*(e%n)+t%n;if(i<0)throw"Invalid level / row / col";return 20+i*this.storageInfo.recordSize+44}},{key:"_getTileEndAndContentType",value:function(e,t){var r,n=e.subarray(t,t+8),i=0;for(r=0;r<5;r++)i|=(255&n[r])<<8*r;var a=0xffffffffff&i;for(i=0,r=5;r<8;r++)i|=(255&n[r])<<8*(r-5);return{position:a,recordSize:0xffffffffff&i}}},{key:"_toHexString4",value:function(e){var t=e.toString(16);if(4!==t.length)for(var r=4-t.length;r-- >0;)t="0"+t;return t}}]),r}(fe);(0,h._)([(0,b.Cb)({readOnly:!0})],xe.prototype,"storageInfo",void 0),(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],xe.prototype,"datasetFormat",void 0);var ge=xe=(0,h._)([(0,C.j)("esri.layers.support.rasterDatasets.CloudRaster")],xe),be=r(78519),ke=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).datasetFormat="MEMORY",e}return(0,s.Z)(r,[{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c,h,p,d,m,v,y,x;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return n=this.data,i=n.pixelBlock,a=n.statistics,s=n.histograms,o=n.name,l=n.keyProperties,u=n.nativeExtent,c=n.transform,h=i.width,p=i.height,d=i.pixelType,m=this.data.extent||new j.Z({xmin:-.5,ymin:.5,xmax:h-.5,ymax:p-.5,spatialReference:new q.Z({wkid:3857})}),v=null!==(r=this.data.isPseudoSpatialReference)&&void 0!==r?r:!this.data.extent,y={x:m.width/h,y:m.height/p},x=new ee.Z({width:h,height:p,pixelType:d,extent:m,nativeExtent:u,transform:c,pixelSize:y,spatialReference:m.spatialReference,bandCount:3,keyProperties:l||{},statistics:a,isPseudoSpatialReference:v,histograms:s}),this.createRemoteDatasetStorageInfo(x,512,512),this._set("rasterInfo",x),this.updateTileInfo(),e.next=8,this._buildInMemoryRaster(i,{width:512,height:512},t);case 8:this.datasetName=o,this.url="/InMemory/"+o;case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(e,t,r){var n=this._pixelBlockTiles.get("".concat(e,"/").concat(t,"/").concat(r));return Promise.resolve(n)}},{key:"_buildInMemoryRaster",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=this.rasterInfo.storageInfo.maximumPyramidLevel,o=this.rasterJobHandler?this.rasterJobHandler.split({pixelBlock:t,tileSize:r,maximumPyramidLevel:s},n):Promise.resolve((0,oe.Vl)(t,r,s)),l=(0,v.pC)(this.rasterInfo.statistics),u=(0,v.pC)(this.rasterInfo.histograms),c=l?Promise.resolve({statistics:null,histograms:null}):this.rasterJobHandler?this.rasterJobHandler.estimateStatisticsHistograms({pixelBlock:t},n):Promise.resolve((0,be.Hv)(t)),e.next=7,(0,x.as)([o,c]);case 7:if((h=e.sent)[0].value||!h[1].value){e.next=10;break}throw new m.Z("inmemory-raster:open","failed to build in memory raster");case 10:this._pixelBlockTiles=h[0].value,l||(this.rasterInfo.statistics=null===(i=h[1].value)||void 0===i?void 0:i.statistics),u||(this.rasterInfo.histograms=null===(a=h[1].value)||void 0===a?void 0:a.histograms);case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()}]),r}(fe);(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],ke.prototype,"datasetFormat",void 0),(0,h._)([(0,b.Cb)()],ke.prototype,"data",void 0);var we=ke=(0,h._)([(0,C.j)("esri.layers.support.rasterDatasets.InMemoryRaster")],ke);function Ie(e,t){if(!e||!t)return[];var r=t;t.includes("/")?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=[];if(t){for(var i=Ie(e,r),a=0;a<i.length;a++)Ie(i[a],t).forEach((function(e){return n.push(e)}));return n}var s=e.getElementsByTagNameNS("*",r);if(!s||0===s.length)return[];for(var o=0;o<s.length;o++)n.push(s[o]||s.item[o]);return n}function _e(e,t){if(!e||!t)return null;var r=t;t.includes("/")?(r=t.slice(0,t.indexOf("/")),t=t.slice(t.indexOf("/")+1)):t="";var n=Ie(e,r);return n.length>0?t?_e(n[0],t):n[0]:null}function Ce(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=r?_e(e,r):e;return n?(t=n.textContent||n.nodeValue)?t.trim():null:null}function Se(e,t){for(var r,n=Ie(e,t),i=[],a=0;a<n.length;a++)(r=n[a].textContent||n[a].nodeValue)&&(""!==(r=r.trim())&&i.push(r));return i}function Te(e,t){return Se(e,t).map((function(e){return Number(e)}))}function Ze(e,t){var r=Ce(e,t);return Number(r)}function Re(e,t){var r,n=null===e||void 0===e||null===(r=e.nodeName)||void 0===r?void 0:r.toLowerCase(),i=t.toLowerCase();return n.slice(n.lastIndexOf(":")+1)===i}var Me=r(35186);function Pe(e,t){if(!e||!t)return null;for(var r=[],n=0;n<e.length;n++)r.push(e[n]),r.push(t[n]);return r}function Oe(e){if(!e)return null;var t=Number(e);if(!isNaN(t)&&0!==t)return new q.Z({wkid:t});if((e=String(e)).startsWith("COMPD_CS")){if(!e.includes("VERTCS")||!e.includes("GEOGCS")&&!e.startsWith("PROJCS"))return null;var r=e.indexOf("VERTCS"),n=e.indexOf("PROJCS"),i=n>-1?n:e.indexOf("GEOGCS");if(-1===i)return null;var a=e.slice(i,e.lastIndexOf("]",r)+1).trim(),s=e.slice(r,e.lastIndexOf("]")).trim();t=Be(a);var o=new q.Z(t?{wkid:t}:{wkt:a}),l=Be(s);return l&&(o.vcsWkid=l),o}return e.startsWith("GEOGCS")||e.startsWith("PROJCS")?(t=Be(e),new q.Z(0!==t?{wkid:t}:{wkt:e})):null}function Be(e){var t,r=e.replace(/\]/g,"[").replace(/\"/g,"").split("[").map((function(e){return e.trim()})).filter((function(e){return""!==e})),n=r[r.length-1].split(","),i=null===(t=n[0])||void 0===t?void 0:t.toLowerCase();if(("epsg"===i||"esri"===i)&&e.endsWith('"]]')){var a=Number(n[1]);if(!isNaN(a)&&0!==a)return a}return 0}function Fe(e){var t;if("pamdataset"!==(null===e||void 0===e||null===(t=e.documentElement.tagName)||void 0===t?void 0:t.toLowerCase()))return{};var r={spatialReference:null,transform:null,metadata:{},rasterBands:[],statistics:null,histograms:null};e.documentElement.childNodes.forEach((function(e){if(1===e.nodeType)if(Re(e,"SRS")){if(!r.spatialReference){var t=Ce(e);r.spatialReference=Oe(t)}}else if(Re(e,"Metadata"))if("xml:ESRI"===e.getAttribute("domain")){var n=function(e){var t,r=_e(e,"GeodataXform"),n=Oe(Ze(r,"SpatialReference/WKID")||Ce(r,"SpatialReference/WKT"));if("typens:PolynomialXform"!==r.getAttribute("xsi:type"))return{spatialReference:n,transform:null};var i=null!==(t=Ze(r,"PolynomialOrder"))&&void 0!==t?t:1,a=Te(r,"CoeffX/Double"),s=Te(r,"CoeffY/Double"),o=Te(r,"InverseCoeffX/Double"),l=Te(r,"InverseCoeffY/Double"),u=Pe(a,s),c=Pe(o,l);return{spatialReference:n,transform:new Me.Z({spatialReference:n,polynomialOrder:i,forwardCoefficients:u,inverseCoefficients:c})}}(e),i=n.spatialReference,a=n.transform;r.transform=a,r.spatialReference||(r.spatialReference=i)}else Ie(e,"MDI").forEach((function(e){return r.metadata[e.getAttribute("key")]=Ce(e)}));else if(Re(e,"PAMRasterBand")){var s=function(e){var t,r,n,i,a,s=Ze(e,"NoDataValue"),o=_e(e,"Histograms/HistItem"),l=Ze(o,"HistMin"),u=Ze(o,"HistMax"),c=Ze(o,"BucketCount"),f=null===(t=Ce(o,"HistCounts"))||void 0===t?void 0:t.split("|").map((function(e){return Number(e)}));Ie(e,"Metadata/MDI").forEach((function(e){var t,s=Number(null!==(t=e.textContent)&&void 0!==t?t:e.nodeValue);switch(e.getAttribute("key").toUpperCase()){case"STATISTICS_MINIMUM":r=s;break;case"STATISTICS_MAXIMUM":n=s;break;case"STATISTICS_MEAN":i=s;break;case"STATISTICS_STDDEV":a=s}}));var h=Ze(e,"Metadata/SourceBandIndex");return{noDataValue:s,histogram:null!==f&&void 0!==f&&f.length&&null!=r&&null!=n?{min:l,max:u,size:c||f.length,counts:f}:null,sourceBandIndex:h,statistics:null!=r&&null!=n?{min:r,max:n,avg:i,stddev:a}:null}}(e);null!=s.sourceBandIndex&&null==r.rasterBands[s.sourceBandIndex]?r.rasterBands[s.sourceBandIndex]=s:r.rasterBands.push(s)}}));var n=r.rasterBands;if(n){var i=!!n[0].statistics;r.statistics=i?n.map((function(e){return e.statistics})):null;var a=!!n[0].histogram;r.histograms=a?n.map((function(e){return e.histogram})):null}return r}var ze=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,s.Z)(r,[{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c,h,p,d,m;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return e.next=4,this._fetchData(t);case 4:return r=e.sent,e.next=7,this._fetchAuxiliaryData(t);case 7:return n=e.sent,i=n.spatialReference,a=n.statistics,s=n.histograms,o=n.transform,(l=!i)&&(i=new q.Z({wkid:3857})),(null===s||void 0===s?void 0:s.length)&&null==a&&(a=(0,be.Oh)(s)),u=r.width,c=r.height,h=new j.Z({xmin:-.5,ymin:.5-c,xmax:u-.5,ymax:.5,spatialReference:i}),p=o?o.forwardTransform(h):h,!0,o&&(d=o.forwardCoefficients,d&&0===d[1]&&0===d[2]&&(o=null,h=p)),m=new we({data:{extent:p,nativeExtent:h,transform:o,pixelBlock:r,statistics:a,histograms:s,keyProperties:{DateType:"Processed"},isPseudoSpatialReference:l}}),e.next=22,m.open();case 22:m.data=null,this._set("rasterInfo",m.rasterInfo),this._inMemoryRaster=m;case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._inMemoryRaster.fetchRawTile(e,t,r,n)}},{key:"_fetchData",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(this.url,{responseType:"array-buffer",signal:null===t||void 0===t?void 0:t.signal});case 2:if(r=e.sent,n=r.data,"JPG"===(i=(0,se.y)(n).toUpperCase())||"PNG"===i||"GIF"===i||"BMP"===i){e.next=7;break}throw new m.Z("image-aux-raster:open","the data is not a supported format");case 7:return this._set("datasetFormat",i),a=i.toLowerCase(),s="gif"===a||"bmp"===a||!(0,k.Z)("ios"),e.next=11,this.decodePixelBlock(n,{format:a,useCanvas:s,hasNoZlibMask:!0});case 11:return e.abrupt("return",e.sent);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchAuxiliaryData",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c,h,p;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(0,v.Wg)(null===t||void 0===t?void 0:t.signal),a=null!==(r=this.ioConfig.skipExtensions)&&void 0!==r?r:[],s=a.includes("aux.xml")?null:this.request(this.url+".aux.xml",{responseType:"xml",signal:i}),o=this.datasetFormat,l="JPG"===o?"jgw":"PNG"===o?"pgw":"BMP"===o?"bpw":null,u=a.includes(l)?null:this.request(this.url.slice(0,this.url.lastIndexOf("."))+"."+l,{responseType:"text",signal:i}),e.next=8,(0,x.as)([s,u]);case 8:if(c=e.sent,null===i||void 0===i||!i.aborted){e.next=11;break}throw(0,x.zE)();case 11:return(h=Fe(null===(n=c[0].value)||void 0===n?void 0:n.data)).transform||(p=c[1].value?c[1].value.data.split("\n").slice(0,6).map((function(e){return Number(e)})):null,h.transform=6===(null===p||void 0===p?void 0:p.length)?new Me.Z({forwardCoefficients:[p[4],p[5],p[0],-p[1],p[2],-p[3]]}):null),e.abrupt("return",h);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}(fe);(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],ze.prototype,"datasetFormat",void 0);var De=ze=(0,h._)([(0,C.j)("esri.layers.support.rasterDatasets.ImageAuxRaster")],ze),Ee=r(68868),Ae=r(73620),Ne=r(68328),Le=r(63325),He=r(87692),We=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._levelOffset=0,e._tilemapCache=null,e._slices=null,e.datasetFormat="RasterTileServer",e}return(0,s.Z)(r,[{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c,h,p,d,y,x,g,b,k,w,I,_,C,S,T,Z,M;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:if(r=t&&t.signal,!this.sourceJSON){e.next=7;break}e.t0={data:this.sourceJSON},e.next=10;break;case 7:return e.next=9,this.request(this.url,{query:{f:"json"},signal:r});case 9:e.t0=e.sent;case 10:if((n=e.t0).ssl&&(this.url=this.url.replace(/^http:/i,"https:")),i=n.data,this.sourceJSON=i,i){e.next=15;break}throw new m.Z("imageserverraster:open","cannot initialize tiled image service, missing service info");case 15:if(i.tileInfo){e.next=17;break}throw new m.Z("imageserverraster:open","use ImageryLayer to open non-tiled image services");case 17:return this._fixScaleInServiceInfo(),a=["jpg","jpeg","png","png8","png24","png32","mixed"],this.tileType=i.cacheType,null==this.tileType&&(a.includes(i.tileInfo.format.toLowerCase())?this.tileType="Map":"lerc"===i.tileInfo.format.toLowerCase()?this.tileType="Elevation":this.tileType="Raster"),this.datasetName=i.name.slice(i.name.indexOf("/")+1),e.next=22,this._fetchRasterInfo({signal:r});case 22:if(s=e.sent,(0,v.pC)(s)){e.next=25;break}throw new m.Z("image-server-raster:open","cannot initialize image service");case 25:u="Map"===this.tileType?(0,Ae.d)(i.tileInfo,i):A.Z.fromJSON(i.tileInfo),c=s.extent,h=s.pixelSize,p=.5/s.width*h.x,x=u.lodAt(Math.max.apply(null,u.lods.map((function(e){return e.level})))),"Map"!==this.tileType&&0!==i.maxScale&&("Raster"===this.tileType?(d=u.lods.find((function(e){return e.resolution===h.x})),d||(d=u.lods[u.lods.length-1])):(d=u.lods.find((function(e){return Math.abs(e.scale-i.maxScale)<p})),d||(d=u.lods.filter((function(e){return e.scale>i.maxScale})).sort((function(e,t){return e.scale>t.scale?1:-1}))[0])),h.x=h.y=d.resolution,s.width=Math.ceil((c.xmax-c.xmin)/h.x-.1),s.height=Math.ceil((c.ymax-c.ymin)/h.y-.1)),d||(d=x),g=u.lodAt(Math.min.apply(null,u.lods.map((function(e){return e.level})))),"Map"===this.tileType?this._levelOffset=u.lods[0].level:0!==i.minScale&&"Elevation"===this.tileType&&(y=u.lods.find((function(e){return Math.abs(e.scale-i.minScale)<p})),this._levelOffset=y.level-g.level),y||(y=g),b=Math.max(h.x,h.y),(Math.abs(h.x-h.y)>p||!u.lods.some((function(e){return Math.abs(e.resolution-b)<p})))&&(h.x=h.y=d.resolution,s.width=Math.ceil((c.xmax-c.xmin)/h.x-.1),s.height=Math.ceil((c.ymax-c.ymin)/h.y-.1)),k=d.level-y.level,w=(0,R.Z)(u.size,2),I=w[0],_=w[1],C=[],u.lods.forEach((function(e){e.level>=y.level&&e.level<=d.level&&C.push({x:e.resolution,y:e.resolution})})),C.sort((function(e,t){return e.x-t.x})),S=this.computeBlockBoundary(c,I,_,u.origin,C,k),T=C.length>1?C.slice(1):null,i.transposeInfo&&(Z={tileSize:[i.transposeInfo.rows,i.transposeInfo.cols],packetSize:null!==(o=null===(l=s.keyProperties)||void 0===l?void 0:l._yxs.PacketSize)&&void 0!==o?o:0}),s.storageInfo=new te.Z({blockWidth:u.size[0],blockHeight:u.size[1],pyramidBlockWidth:u.size[0],pyramidBlockHeight:u.size[1],pyramidResolutions:T,compression:u.format,origin:u.origin,firstPyramidLevel:1,maximumPyramidLevel:k,tileInfo:u,transposeInfo:Z,blockBoundary:S}),this._fixGCSShift(s),this._set("rasterInfo",s),i.capabilities.toLowerCase().includes("tilemap")&&(M={tileInfo:s.storageInfo.tileInfo,parsedUrl:(0,Ee.mN)(this.url),url:this.url,tileServers:[],type:"tile"},this._tilemapCache=new Ne.y({layer:M}));case 37:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_,C,S,T,Z,R,M,P,O,B,F=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=F.length>3&&void 0!==F[3]?F[3]:{},a=this.rasterInfo,s=a.storageInfo,o=a.extent,l=s.transposeInfo,u=(0,v.pC)(l)&&!!i.transposedVariableName,!this._slices||u||null!=i.sliceId){e.next=4;break}return e.abrupt("return",null);case 4:return c=u?0:s.maximumPyramidLevel-t+this._levelOffset,h="".concat(this.url,"/tile/").concat(c,"/").concat(r,"/").concat(n),p=this._slices?u?{variable:i.transposedVariableName}:{sliceId:i.sliceId||0}:null,e.next=9,this.request(h,{query:p,responseType:"array-buffer",signal:i.signal});case 9:if(d=e.sent,m=d.data){e.next=13;break}return e.abrupt("return",null);case 13:return y=u?l.tileSize:s.tileInfo.size,e.next=16,this.decodePixelBlock(m,{width:y[0],height:y[1],planes:null,pixelType:null,isPoint:"Elevation"===this.tileType,returnPixelInterleavedDims:u});case 16:if(x=e.sent,g=s.blockBoundary[t],!("jpg"!==s.compression||n>g.minCol&&n<g.maxCol&&r>g.minRow&&r<g.maxRow)){e.next=20;break}return e.abrupt("return",x);case 20:return b=s.origin,k=s.blockWidth,w=s.blockHeight,I=this.getPyramidPixelSize(t),_=I.x,C=I.y,S=Math.round((o.xmin-b.x)/_)%k,T=Math.round((o.xmax-b.x)/_)%k||k,Z=Math.round((b.y-o.ymax)/C)%w,R=Math.round((b.y-o.ymin)/C)%w||w,M=n===g.minCol?S:0,P=r===g.minRow?Z:0,O=n===g.maxCol?T:k,B=r===g.maxRow?R:w,e.abrupt("return",((0,oe.pW)(x,{x:M,y:P},{width:O-M,height:B-P}),x));case 22:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"getSliceIndex",value:function(e){if(!this._slices||(0,v.Wi)(e)||0===e.length)return null;for(var t=e,r=0;r<this._slices.length;r++){var n=this._slices[r].multidimensionalDefinition;if(n.length===t.length&&!n.some((function(e){var r=t.find((function(t){return e.variableName===t.variableName&&t.dimensionName===e.dimensionName}));return!r||(Array.isArray(e.values[0])?"".concat(e.values[0][0],"-").concat(e.values[0][1]):e.values[0])!==(Array.isArray(r.values[0])?"".concat(r.values[0][0],"-").concat(r.values[0][1]):r.values[0])})))return r}return null}},{key:"fetchVariableStatisticsHistograms",value:function(){var e=(0,n.Z)(f.mark((function e(t,r){var n,i,a;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.request(this.url+"/statistics",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.statistics})),i=this.request(this.url+"/histograms",{query:{variable:t,f:"json"},signal:r}).then((function(e){var t;return null===(t=e.data)||void 0===t?void 0:t.histograms})),e.next=4,Promise.all([n,i]);case 4:return a=e.sent,e.abrupt("return",(a[0]&&a[0].forEach((function(e){e.avg=e.mean,e.stddev=e.standardDeviation})),{statistics:a[0]||null,histograms:a[1]||null}));case 6:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"computeBestPyramidLevelForLocation",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=l.length>1&&void 0!==l[1]?l[1]:{},this._tilemapCache){e.next=3;break}return e.abrupt("return",0);case 3:if(null!==(n=this.identifyPixelLocation(t,0,(0,v.Wg)(r.datumTransformation)))){e.next=6;break}return e.abrupt("return",null);case 6:i=0,a=this.rasterInfo.storageInfo.maximumPyramidLevel,s=a-i+this._levelOffset,o=n.srcLocation;case 10:if(!(s>=0)){e.next=25;break}return e.prev=11,e.next=14,this._tilemapCache.fetchAvailability(s,n.row,n.col,r);case 14:if(e.t0=e.sent,"available"!==e.t0){e.next=17;break}return e.abrupt("break",25);case 17:e.next=21;break;case 19:e.prev=19,e.t1=e.catch(11);case 21:if(s--,i++,null!==(n=this.identifyPixelLocation(o,i,(0,v.Wg)(r.datumTransformation)))){e.next=23;break}return e.abrupt("return",null);case 23:e.next=10;break;case 25:return e.abrupt("return",-1===s||null==n?null:i);case 26:case"end":return e.stop()}}),e,this,[[11,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchRasterInfo",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.sourceJSON,"Map"!==this.tileType){e.next=4;break}return n=Math.ceil((r.extent.xmax-r.extent.xmin)/r.pixelSizeX-.1),i=Math.ceil((r.extent.ymax-r.extent.ymin)/r.pixelSizeY-.1),a=q.Z.fromJSON(r.spatialReference||r.extent.spatialReference),s=new ue.Z({x:r.pixelSizeX,y:r.pixelSizeY,spatialReference:a}),e.abrupt("return",new ee.Z({width:n,height:i,bandCount:3,extent:j.Z.fromJSON(r.extent),spatialReference:a,pixelSize:s,pixelType:"u8",statistics:null,keyProperties:{DataType:"processed"}}));case 4:return o=t.signal,l=(0,He.g)(this.url,this.sourceJSON,{signal:o,query:this.ioConfig.customFetchParameters}),u=r.hasMultidimensions?this.request("".concat(this.url,"/slices"),{query:{f:"json"},signal:o}).then((function(e){return e.data&&e.data.slices})).catch((function(){return null})):null,e.next=9,Promise.all([l,u]);case 9:return c=e.sent,e.abrupt("return",(this._slices=c[1],c[0]));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fixScaleInServiceInfo",value:function(){var e=this.sourceJSON;e.minScale&&e.minScale<0&&(e.minScale=0),e.maxScale&&e.maxScale<0&&(e.maxScale=0)}},{key:"_fixGCSShift",value:function(e){var t=e.extent,r=e.spatialReference;0===t.xmin&&360===t.xmax&&r.wkid&&r.isGeographic&&(e.nativeExtent=e.extent,e.transform=new Le.Z,e.extent=e.transform.forwardTransform(t))}}]),r}(fe);(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],We.prototype,"datasetFormat",void 0),(0,h._)([(0,b.Cb)()],We.prototype,"tileType",void 0);var Je=We=(0,h._)([(0,C.j)("esri.layers.support.rasterDatasets.ImageServerRaster")],We),je=r(82386),qe=r(98253),Ge=new Map;Ge.set("Int8","s8"),Ge.set("UInt8","u8"),Ge.set("Int16","s16"),Ge.set("UInt16","u16"),Ge.set("Int32","s32"),Ge.set("UInt32","u32"),Ge.set("Float32","f32"),Ge.set("Float64","f32"),Ge.set("Double64","f32");var Ue=new Map;Ue.set("none",{blobExtension:".til",isOneSegment:!0,decoderFormat:"bip"}),Ue.set("lerc",{blobExtension:".lrc",isOneSegment:!1,decoderFormat:"lerc"}),Ue.set("deflate",{blobExtension:".pzp",isOneSegment:!0,decoderFormat:"deflate"}),Ue.set("jpeg",{blobExtension:".pjg",isOneSegment:!0,decoderFormat:"jpg"});var Ve=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._files=null,e._storageIndex=null,e.datasetFormat="MRF",e}return(0,s.Z)(r,[{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_,C;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),n=t?(0,v.Wg)(t.signal):null,e.next=6,this.request(this.url,{responseType:"xml",signal:n});case 6:if(i=e.sent,a=this._parseHeader(i.data),s=a.rasterInfo,o=a.files,-1!==(null===(r=this.ioConfig.skipExtensions)||void 0===r?void 0:r.indexOf("aux.xml"))){e.next=15;break}return e.next=13,this._fetchAuxiliaryData(t);case 13:null!=(u=e.sent)&&(s.statistics=null!==(l=u.statistics)&&void 0!==l?l:s.statistics,s.histograms=u.histograms,u.histograms&&(0,v.Wi)(s.statistics)&&(s.statistics=(0,be.Oh)(u.histograms)));case 15:return this._set("rasterInfo",s),this._files=o,e.next=18,this.request(o.index,{responseType:"array-buffer",signal:n});case 18:for(c=e.sent,this._storageIndex=this._parseIndex(c.data),h=this.rasterInfo.storageInfo,p=h.blockWidth,d=h.blockHeight,m=this.rasterInfo.storageInfo.pyramidScalingFactor,y=this.rasterInfo,x=y.width,g=y.height,b=[],k=this._getBandSegmentCount(),w=0,I=-1;w<this._storageIndex.length;)I++,_=Math.ceil(x/p/Math.pow(m,I))-1,C=Math.ceil(g/d/Math.pow(m,I))-1,w+=(_+1)*(C+1)*k*4,b.push({maxRow:C,maxCol:_,minCol:0,minRow:0});this.rasterInfo.storageInfo.blockBoundary=b,I>0&&(this.rasterInfo.storageInfo.firstPyramidLevel=1,this.rasterInfo.storageInfo.maximumPyramidLevel=I),this.updateTileInfo();case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,y,x,g,b,k,w,I,_,C,S,T,Z,R,M,P,O,B,F,z,D=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=D.length>3&&void 0!==D[3]?D[3]:{},a=this.rasterInfo.storageInfo,s=a.blockWidth,o=a.blockHeight,l=a.blockBoundary,!(!(u=l[t])||u.maxRow<r||u.maxCol<n||u.minRow>r||u.minCol>n)){e.next=4;break}return e.abrupt("return",null);case 4:if(c=this.rasterInfo,h=c.bandCount,p=c.pixelType,d=this._getTileLocation(t,r,n),m=d.ranges,y=d.actualTileWidth,x=d.actualTileHeight,m&&0!==m.length){e.next=7;break}return e.abrupt("return",null);case 7:if(0!==m[0].from||0!==m[0].to){e.next=10;break}return g=new Uint8Array(s*o),e.abrupt("return",new je.Z({width:s,height:o,pixels:null,mask:g,validPixelCount:0}));case 10:for(b=this.ioConfig.bandIds,k=this._getBandSegmentCount(),w=[],I=0,I=0;I<k;I++)(!b||b.indexOf[I]>-1)&&w.push(this.request(this._files.data,{range:{from:m[I].from,to:m[I].to},responseType:"array-buffer",signal:i.signal}));return e.next=15,Promise.all(w);case 15:for(_=e.sent,C=_.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),S=new Uint8Array(C),T=0,I=0;I<k;I++)S.set(new Uint8Array(_[I].data),T),T+=_[I].data.byteLength;return Z=Ue.get(this.rasterInfo.storageInfo.compression).decoderFormat,e.next=23,this.decodePixelBlock(S.buffer,{width:s,height:o,format:Z,planes:(null===b||void 0===b?void 0:b.length)||h,pixelType:p});case 23:if(R=e.sent,(0,v.pC)(this.rasterInfo.noDataValue)&&"lerc"!==Z&&!R.mask&&null!=(M=this.rasterInfo.noDataValue[0])){if(P=R.width*R.height,O=new Uint8Array(P),Math.abs(M)>1e24)for(I=0;I<P;I++)Math.abs((R.pixels[0][I]-M)/M)>1e-6&&(O[I]=1);else for(I=0;I<P;I++)R.pixels[0][I]!==M&&(O[I]=1);R.mask=O}if(B=0,F=0,y!==s||x!==o)if(z=R.mask)for(I=0;I<o;I++)if(F=I*s,I<x)for(B=y;B<s;B++)z[F+B]=0;else for(B=0;B<s;B++)z[F+B]=0;else for(z=new Uint8Array(s*o),R.mask=z,I=0;I<x;I++)for(F=I*s,B=0;B<y;B++)z[F+B]=1;return e.abrupt("return",R);case 28:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_parseIndex",value:function(e){if(e.byteLength%16>0)throw"invalid array buffer must be multiples of 16";var t,r,n,i,a,s;if(qe.f){for(r=new Uint8Array(e),i=new ArrayBuffer(e.byteLength),n=new Uint8Array(i),a=0;a<e.byteLength/4;a++)for(s=0;s<4;s++)n[4*a+s]=r[4*a+3-s];t=new Uint32Array(i)}else t=new Uint32Array(e);return t}},{key:"_getBandSegmentCount",value:function(){return Ue.get(this.rasterInfo.storageInfo.compression).isOneSegment?1:this.rasterInfo.bandCount}},{key:"_getTileLocation",value:function(e,t,r){var n,i,a,s=this.rasterInfo.storageInfo,o=s.blockWidth,l=s.blockHeight,u=s.pyramidScalingFactor,c=this.rasterInfo,f=c.width,h=c.height,p=this._getBandSegmentCount(),d=0,m=0;for(a=0;a<e;a++)m=Math.pow(u,a),d+=(n=Math.ceil(f/o/m))*(i=Math.ceil(h/l/m));m=Math.pow(u,e),n=Math.ceil(f/o/m),i=Math.ceil(h/l/m),d+=t*n+r,d*=4*p;for(var v=this._storageIndex.subarray(d,d+4*p),y=0,x=0,g=[],b=0;b<p;b++)x=(y=v[4*b+0]*Math.pow(2,32)+v[4*b+1])+v[4*b+2]*Math.pow(2,32)+v[4*b+3],g.push({from:y,to:x});return{ranges:g,actualTileWidth:r<n-1?o:Math.ceil(f/m)-o*(n-1),actualTileHeight:t<i-1?l:Math.ceil(h/m)-l*(i-1)}}},{key:"_parseHeader",value:function(e){var t=_e(e,"MRF_META/Raster");if(!t)throw new m.Z("mrf:open","not a valid MRF format");var r=_e(t,"Size"),n=parseInt(r.getAttribute("x"),10),i=parseInt(r.getAttribute("y"),10),a=parseInt(r.getAttribute("c"),10),s=(Ce(t,"Compression")||"none").toLowerCase();if(!Ue.has(s))throw new m.Z("mrf:open","currently does not support compression "+s);var o=Ce(t,"DataType")||"UInt8",l=Ge.get(o);if(null==l)throw new m.Z("mrf:open","currently does not support pixel type "+o);var u,c,f=_e(t,"PageSize"),h=parseInt(f.getAttribute("x"),10),p=parseInt(f.getAttribute("y"),10),d=_e(t,"DataValues");if(d&&(null!=(c=d.getAttribute("NoData"))&&(u=c.trim().split(" ").map((function(e){return parseFloat(e)})))),_e(e,"MRF_META/CachedSource"))throw new m.Z("mrf:open","currently does not support MRF referencing other data files");var v,y=_e(e,"MRF_META/GeoTags"),x=_e(y,"BoundingBox"),g=!1;if(null!=x){var b,k=parseFloat(x.getAttribute("minx")),w=parseFloat(x.getAttribute("miny")),I=parseFloat(x.getAttribute("maxx")),_=parseFloat(x.getAttribute("maxy")),C=Ce(y,"Projection")||"";if("LOCAL_CS[]"!==C)if(C.toLowerCase().startsWith("epsg:")){var S=Number(C.slice(5));isNaN(S)||0===S||(b=new q.Z({wkid:S}))}else b=Oe(C);else g=!0,b=new q.Z({wkid:3857});(v=new j.Z(k,w,I,_)).spatialReference=b}else g=!0,v=new j.Z({xmin:-.5,ymin:.5-i,xmax:n-.5,ymax:.5,spatialReference:new q.Z({wkid:3857})});var T=_e(e,"MRF_META/Rsets"),Z=parseInt(T&&T.getAttribute("scale")||"2",10),R=v.spatialReference,M=new te.Z({origin:new ue.Z({x:v.xmin,y:v.ymax,spatialReference:R}),blockWidth:h,blockHeight:p,pyramidBlockWidth:h,pyramidBlockHeight:p,compression:s,pyramidScalingFactor:Z}),P=new ue.Z({x:v.width/n,y:v.height/i,spatialReference:R}),O=new ee.Z({width:n,height:i,extent:v,isPseudoSpatialReference:g,spatialReference:R,bandCount:a,pixelType:l,pixelSize:P,noDataValue:u,storageInfo:M}),B=Ce(e,"datafile"),F=Ce(e,"IndexFile");return{rasterInfo:O,files:{mrf:this.url,index:F||this.url.replace(".mrf",".idx"),data:B||this.url.replace(".mrf",Ue.get(s).blobExtension)}}}},{key:"_fetchAuxiliaryData",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null===t||void 0===t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",Fe(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(fe);(0,h._)([(0,b.Cb)()],Ve.prototype,"_files",void 0),(0,h._)([(0,b.Cb)()],Ve.prototype,"_storageIndex",void 0),(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],Ve.prototype,"datasetFormat",void 0);var Xe=Ve=(0,h._)([(0,C.j)("esri.layers.support.rasterIO.MRFRaster")],Ve),Ye=r(40950),Ke=r(37623),Qe=function(e,t){var r=e.get(t);return r&&r.values},$e=function(e,t){var r=e.get(t);return r&&r.values[0]},et=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._files=null,e._headerInfo=null,e._bufferSize=1048576,e.datasetFormat="TIFF",e}return(0,s.Z)(r,[{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,a,s,o,l,u,c,h,p,d,y,x,g,b,k,w,I,_,C,S,T,Z,R,M,P,O,B,F,z,D,E,A,N,L,H,W,J;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.init();case 2:return s=t?(0,v.Wg)(t.signal):null,e.next=5,this.request(this.url,{range:{from:0,to:this._bufferSize},responseType:"array-buffer",signal:s});case 5:if(o=e.sent,l=o.data){e.next=9;break}throw new m.Z("tiffraster:open","failed to open url "+this.url);case 9:return this.datasetName=this.url.slice(this.url.lastIndexOf("/")+1),u=(0,Ye.cK)(l),c=u.littleEndian,h=u.firstIFD,p=u.isBigTiff,d=[],e.next=13,this._readIFDs(d,l,c,h,0,p?8:4,s);case 13:if(y=(0,Ye.FI)(d),x=y.width,g=y.height,b=y.tileWidth,k=y.tileHeight,w=y.planes,I=y.pixelType,_=y.compression,C=y.firstPyramidLevel,S=y.maximumPyramidLevel,T=y.pyramidBlockWidth,Z=y.pyramidBlockHeight,R=y.tileBoundary,M=y.affine,P=y.metadata,O=(null===(r=y.extent.spatialReference)||void 0===r?void 0:r.wkt)||(null===(n=y.extent.spatialReference)||void 0===n?void 0:n.wkid),B=Oe(O),F=!1,null==B&&(F=!0,B=new q.Z({wkid:3857})),z=new j.Z((0,i.Z)((0,i.Z)({},y.extent),{},{spatialReference:B})),D=new ue.Z(z?{x:z.xmin,y:z.ymax,spatialReference:B}:{x:0,y:0}),E=new te.Z({blockWidth:b,blockHeight:k,pyramidBlockWidth:T,pyramidBlockHeight:Z,compression:_,origin:D,firstPyramidLevel:C,maximumPyramidLevel:S,blockBoundary:R}),A=new ue.Z({x:(z.xmax-z.xmin)/x,y:(z.ymax-z.ymin)/g,spatialReference:B}),N=P?{BandProperties:P.bandProperties,DataType:P.dataType}:{},L=new ee.Z({width:x,height:g,bandCount:w,pixelType:I,compression:_,pixelSize:A,storageInfo:E,spatialReference:B,isPseudoSpatialReference:F,keyProperties:N,extent:z,statistics:P?P.statistics:null}),null!==M&&void 0!==M&&M.length&&(L.nativeExtent=new j.Z({xmin:-.5,ymin:.5-g,xmax:x-.5,ymax:.5,spatialReference:B}),L.transform=new Me.Z({polynomialOrder:1,forwardCoefficients:[M[2]+M[0]/2,M[5]-M[3]/2,M[0],M[3],-M[1],-M[4]]}),L.extent=L.transform.forwardTransform(L.nativeExtent),L.pixelSize=new ue.Z({x:(z.xmax-z.xmin)/x,y:(z.ymax-z.ymin)/g,spatialReference:B}),E.origin.x=-.5,E.origin.y=.5),null!==(a=this.ioConfig.skipExtensions)&&void 0!==a&&a.includes("aux.xml")){e.next=22;break}return e.next=20,this._fetchAuxiliaryData(t);case 20:null!=(H=e.sent)&&(L.statistics=null!==(W=H.statistics)&&void 0!==W?W:L.statistics,L.histograms=H.histograms,H.histograms&&(0,v.Wi)(L.statistics)&&(L.statistics=(0,be.Oh)(H.histograms)),H.transform&&!M&&(L.transform=H.transform,L.nativeExtent=L.extent,J=L.transform.forwardTransform(L.nativeExtent),L.pixelSize=new ue.Z({x:(J.xmax-J.xmin)/x,y:(J.ymax-J.ymin)/g,spatialReference:B}),L.extent=J),L.spatialReference||(L.spatialReference=H.spatialReference));case 22:if(this._set("rasterInfo",L),this._headerInfo=(0,i.Z)({littleEndian:c,isBigTiff:p,ifds:d},y),this._headerInfo.isSupported){e.next=24;break}throw new m.Z("tiffraster:open","this tiff is not supported: "+this._headerInfo.message);case 24:this.updateTileInfo();case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"fetchRawTile",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a,s,o,l,u,c,h,p,d,m,v,y,x,g,b,k,w,I,_,C,S,T,Z,R,M=this,P=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=P.length>3&&void 0!==P[3]?P[3]:{},null!==(i=this._headerInfo)&&void 0!==i&&i.isSupported&&!this.isBlockOutside(t,r,n)){e.next=3;break}return e.abrupt("return",null);case 3:if(s=this._getTileLocation(t,r,n)){e.next=6;break}return e.abrupt("return",null);case 6:return o=s.ranges,l=s.actualTileWidth,u=s.actualTileHeight,c=s.ifd,h=o.map((function(e){return M.request(M.url,{range:e,responseType:"array-buffer",signal:a.signal})})),e.next=13,Promise.all(h);case 13:if(p=e.sent,d=p.map((function(e){return e.data.byteLength})).reduce((function(e,t){return e+t})),m=1===p.length?p[0].data:new ArrayBuffer(d),v=[0],y=[0],p.length>1)for(x=new Uint8Array(m),g=0,b=0;g<p.length;g++)k=p[g].data,x.set(new Uint8Array(k),b),v[g]=b,b+=k.byteLength,y[g]=k.byteLength;return w=this.getBlockWidthHeight(t),I=w.blockWidth,_=w.blockHeight,e.next=24,this.decodePixelBlock(m,{format:"tiff",customOptions:{headerInfo:this._headerInfo,ifd:c,offsets:v,sizes:y},width:I,height:_,planes:null,pixelType:null});case 24:if(C=e.sent,l!==I||u!==_)if(R=C.mask)for(S=0;S<_;S++)if(Z=S*I,S<u)for(T=l;T<I;T++)R[Z+T]=0;else for(T=0;T<I;T++)R[Z+T]=0;else for(R=new Uint8Array(I*_),C.mask=R,S=0;S<u;S++)for(Z=S*I,T=0;T<l;T++)R[Z+T]=1;return e.abrupt("return",C);case 27:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"_readIFDs",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n,i,a){var s,o,l,u=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=u.length>5&&void 0!==u[5]?u[5]:4,o=u.length>6?u[6]:void 0,i){e.next=4;break}return e.abrupt("return",null);case 4:if(!(i>=r.byteLength||i<0)){e.next=10;break}return e.next=7,this.request(this.url,{range:{from:i+a,to:i+a+this._bufferSize},responseType:"array-buffer",signal:o});case 7:r=e.sent.data,a=i+a,i=0;case 10:return e.next=12,this._readIFD(r,n,i,a,Ke.Z.TIFF_TAGS,s,o);case 12:if(l=e.sent,t.push(l.ifd),l.nextIFD){e.next=15;break}return e.abrupt("return",null);case 15:return e.next=17,this._readIFDs(t,r,n,l.nextIFD-a,a,s,o);case 17:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a){return e.apply(this,arguments)}}()},{key:"_readIFD",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n,i){var a,s,o,l,u,c,h,p,d,m,v,y,x,g,b=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=b.length>4&&void 0!==b[4]?b[4]:Ke.Z.TIFF_TAGS,s=b.length>5&&void 0!==b[5]?b[5]:4,o=b.length>6?b[6]:void 0,t){e.next=5;break}return e.abrupt("return",null);case 5:if(!(l=(0,Ye.vr)(t,r,n,i,a,s)).success){e.next=25;break}if(u=[],l.ifd.forEach((function(e){e.values||u.push(e)})),!(u.length>0)){e.next=16;break}if(c=u.map((function(e){return e.offlineOffsetSize})),h=Math.min.apply(null,c.map((function(e){return e[0]}))),!(Math.min.apply(null,c.map((function(e){return e[0]+e[1]})))-h<=this._bufferSize)){e.next=16;break}return e.next=13,this.request(this.url,{range:{from:h,to:h+this._bufferSize},responseType:"array-buffer",signal:o});case 13:p=e.sent,d=p.data,t=d,i=h,u.forEach((function(e){return(0,Ye.Dq)(t,r,e,i)}));case 16:if(!l.ifd.has("GEOKEYDIRECTORY")){e.next=24;break}if(m=l.ifd.get("GEOKEYDIRECTORY"),!((v=m.values)&&v.length>4)){e.next=24;break}return y=v[0]+"."+v[1]+"."+v[2],e.next=22,this._readIFD(t,r,m.valueOffset+6-i,i,Ke.Z.GEO_KEYS,2,o);case 22:x=e.sent,m.data=x.ifd,m.data&&m.data.set("GEOTIFFVersion",{id:0,type:2,valueCount:1,valueOffset:null,values:[y]});case 24:return e.abrupt("return",l);case 25:if(!l.requiredBufferSize||l.requiredBufferSize===t.byteLength){e.next=30;break}return e.next=28,this.request(this.url,{range:{from:i,to:i+l.requiredBufferSize+4},responseType:"array-buffer",signal:o});case 28:return g=e.sent,e.abrupt("return",(t=g.data).byteLength<l.requiredBufferSize?null:this._readIFD(t,r,0,i,Ke.Z.TIFF_TAGS,4,o));case 30:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i){return e.apply(this,arguments)}}()},{key:"_getTileLocation",value:function(e,t,r){var n=this.rasterInfo.storageInfo,i=n.firstPyramidLevel,a=n.blockBoundary,s=0===e?0:e-(i-1),o=this._headerInfo.ifds[s];if(!o)return null;var l=(0,Ye.If)(o,this._headerInfo),u=Qe(o,"TILEOFFSETS");if(void 0===u)return null;var c=Qe(o,"TILEBYTECOUNTS"),f=a[s],h=f.minRow,p=f.minCol,d=f.maxRow,m=f.maxCol;if(t>d||r>m||t<h||r<p)return null;var v=$e(o,"IMAGEWIDTH"),y=$e(o,"IMAGELENGTH"),x=$e(o,"TILEWIDTH"),g=$e(o,"TILELENGTH"),b=l?this.rasterInfo.bandCount:1,k=b*t*(m+1)+r,w=[{from:u[k],to:u[k+b-1]+c[k+b-1]-1}];if(l){for(var I=!0,_=0;_<b;_++)if(u[k+_]+c[k+_]!==u[k+_+1]){I=!1;break}if(!I)for(var C=0;C<b;C++)w[C]={from:u[k+C],to:u[k+C]+c[k+C]-1}}var S=u[k],T=c[k];return null==S||null==T?null:{ranges:w,ifd:o,actualTileWidth:r===m?v%x:x,actualTileHeight:t===d?y%g:g}}},{key:"_fetchAuxiliaryData",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.request(this.url+".aux.xml",{responseType:"xml",signal:null===t||void 0===t?void 0:t.signal});case 3:return r=e.sent,n=r.data,e.abrupt("return",Fe(n));case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",null);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(fe);(0,h._)([(0,b.Cb)()],et.prototype,"_files",void 0),(0,h._)([(0,b.Cb)()],et.prototype,"_headerInfo",void 0),(0,h._)([(0,b.Cb)()],et.prototype,"_bufferSize",void 0),(0,h._)([(0,b.Cb)({type:String,json:{write:!0}})],et.prototype,"datasetFormat",void 0);var tt=et=(0,h._)([(0,C.j)("esri.layers.support.rasterDatasets.TIFFRaster")],et),rt=new Map;rt.set("CRF",{desc:"Cloud Raster Format",constructor:ge}),rt.set("MRF",{desc:"Meta Raster Format",constructor:Xe}),rt.set("TIFF",{desc:"GeoTIFF",constructor:tt}),rt.set("RasterTileServer",{desc:"Raster Tile Server",constructor:Je}),rt.set("JPG",{desc:"JPG Raster Format",constructor:De}),rt.set("PNG",{desc:"PNG Raster Format",constructor:De}),rt.set("GIF",{desc:"GIF Raster Format",constructor:De}),rt.set("BMP",{desc:"BMP Raster Format",constructor:De});var nt=function(){function e(){(0,a.Z)(this,e)}return(0,s.Z)(e,null,[{key:"supportedFormats",get:function(){var e=new Set;return rt.forEach((function(t,r){return e.add(r)})),e}},{key:"open",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n,i,a,s,o,l,u,c,h;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.url,n=t.ioConfig,i=t.sourceJSON,null==(a=t.datasetFormat)&&r.lastIndexOf(".")&&(a=r.slice(r.lastIndexOf(".")+1).toUpperCase()),"OVR"===a||"TIF"===a?a="TIFF":"JPG"!==a&&"JPEG"!==a&&"JFIF"!==a||(a="JPG"),r.toLowerCase().includes("/imageserver")&&!r.toLowerCase().includes("/wcsserver")&&(a="RasterTileServer"),s={url:r,sourceJSON:i,datasetFormat:a,ioConfig:n||{bandIds:null,sampling:null}},!this.supportedFormats.has(a)){e.next=12;break}if("CRF"!==a||n.enableCRF){e.next=7;break}throw new m.Z("rasterfactory:open","cannot open raster: ".concat(r));case 7:return o=rt.get(a).constructor,l=new o(s),e.next=11,l.open({signal:t.signal});case 11:return e.abrupt("return",l);case 12:if(!a){e.next=14;break}throw new m.Z("rasterfactory:open","not a supported format "+a);case 14:return u=Array.from(rt.keys()),c=0,h=function e(){return(a=u[c++])&&("CRF"!==a||n.enableCRF)?(o=rt.get(a).constructor,(l=new o(s)).open({signal:t.signal}).then((function(){return l})).catch((function(){return e()}))):null},e.abrupt("return",h());case 18:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"register",value:function(e,t,r){rt.has(e.toUpperCase())||rt.set(e.toUpperCase(),{desc:t,constructor:r})}}]),e}(),it=r(16636),at=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;(0,a.Z)(this,r);for(var n=arguments.length,i=new Array(n),s=0;s<n;s++)i[s]=arguments[s];return(e=t.call.apply(t,[this].concat(i))).bandIds=null,e.interpolation=null,e.legendEnabled=!0,e.isReference=null,e.listMode="show",e.sourceJSON=null,e.version=null,e.title=null,e.type="imagery-tile",e.operationalLayerType="ArcGISTiledImageServiceLayer",e.popupEnabled=!0,e.popupTemplate=null,e.fields=null,e}return(0,s.Z)(r,[{key:"normalizeCtorArgs",value:function(e,t){return"string"==typeof e?(0,i.Z)({url:e},t):e}},{key:"load",value:function(e){var t=this,r=(0,v.pC)(e)?e.signal:null;return this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Image Service"]},e).catch(x.r9).then((function(){return t._openRaster(r)}))),Promise.resolve(this)}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"rasterFields",get:function(){var e,t,r=[new Q.Z({name:"Raster.ServicePixelValue",alias:"Pixel Value",domain:null,editable:!1,length:50,type:"string"})],n=null===(e=this.rasterInfo)||void 0===e||null===(t=e.attributeTable)||void 0===t?void 0:t.fields;if(n){var i=n.filter((function(e){return"oid"!==e.type&&"value"!==e.name.toLowerCase()})).map((function(e){var t=e.clone();return t.name="Raster."+e.name,t}));r=r.concat(i)}var a=this.rasterInfo.dataType;if(("vector-magdir"===a||"vector-uv"===a)&&(0,v.pC)(this.rasterInfo.multidimensionalInfo)){var s,o=null===(s=this.rasterInfo.multidimensionalInfo.variables[0].unit)||void 0===s?void 0:s.trim(),l="Magnitude"+(o?" (".concat(o,")"):"");r.push(new Q.Z({name:"Raster.Magnitude",alias:l,domain:null,editable:!1,type:"double"})),r.push(new Q.Z({name:"Raster.Direction",alias:"Direction (\xb0)",domain:null,editable:!1,type:"double"}))}return r}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"readRenderer",value:function(e,t,r){var n=t&&t.layerDefinition&&t.layerDefinition.drawingInfo&&t.layerDefinition.drawingInfo.renderer,i=(0,d.ij)(n,r)||void 0;if(null!=i)return i}},{key:"createPopupTemplate",value:function(e){return(0,it.eZ)({fields:this.rasterFields,title:this.title},e)}},{key:"write",value:function(e,t){var n=this.raster;if(this.loaded?"RasterTileServer"===n.datasetFormat&&("Raster"===n.tileType||"Map"===n.tileType):this.url&&/\/ImageServer(\/|\/?$)/i.test(this.url))return(0,o.Z)((0,l.Z)(r.prototype),"write",this).call(this,e,t);if(t&&t.messages){var i="".concat(t.origin,"/").concat(t.layerContainerType||"operational-layers");t.messages.push(new m.Z("layer:unsupported","Layers (".concat(this.title,", ").concat(this.id,") of type '").concat(this.declaredClass,"' are not supported in the context of '").concat(i,"'"),{layer:this}))}return null}},{key:"_openRaster",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n=this;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.raster){e.next=8;break}if(e.t0=this.raster.rasterInfo,e.t0){e.next=5;break}return e.next=5,this.raster.open();case 5:this.url=this.raster.url,e.next=11;break;case 8:return e.next=10,nt.open({url:this.url,sourceJSON:this.sourceJSON,ioConfig:(0,i.Z)((0,i.Z)({sampling:"closest"},this.ioConfig),{},{customFetchParameters:this.customParameters}),signal:t});case 10:this.raster=e.sent;case 11:if(this.raster.rasterInfo){e.next=14;break}throw new m.Z("imagery-tile-layer:load","cannot load resources on "+this.url);case 14:this.sourceJSON=this.sourceJSON||this.raster.sourceJSON,null!=this.sourceJSON&&(r="Map"===this.raster.tileType&&null!=this.sourceJSON.minLOD&&null!=this.sourceJSON.maxLOD?this.sourceJSON:(0,i.Z)((0,i.Z)({},this.sourceJSON),{},{minScale:0,maxScale:0}),this.read(r,{origin:"service"})),null==this.title&&(this.title=this.raster.datasetName),"Map"===this.raster.tileType&&(this.popupEnabled=!1),this._configDefaultSettings(),this.own((0,g.YP)((function(){return n.customParameters}),(function(e){n.raster.ioConfig.customFetchParameters=e})));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),r}((0,T.h)((0,Y.M)((0,U.q)((0,V.I)((0,Z.N)(function(e){var t=function(e){(0,u.Z)(r,e);var t=(0,c.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._rasterJobHandler={instance:null,refCount:0,connectionPromise:null},e.bandIds=null,e.copyright=null,e.fullExtent=null,e.interpolation="nearest",e.multidimensionalDefinition=null,e.raster=null,e.rasterInfo=null,e.sourceJSON=null,e.spatialReference=null,e.tileInfo=null,e.symbolizer=null,e}return(0,s.Z)(r,[{key:"url",set:function(e){this._set("url",(0,F.Nm)(e,G))}},{key:"renderer",set:function(e){this._set("renderer",e),this.updateRenderer()}},{key:"convertVectorFieldData",value:function(){var e=(0,n.Z)(f.mark((function e(t,r){var n,i;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,v.Wi)(t)){e.next=2;break}return e.abrupt("return",null);case 2:return n=this._rasterJobHandler.instance,i=this.rasterInfo.dataType,e.abrupt("return",n?n.convertVectorFieldData({pixelBlock:t,dataType:i},r):(0,L.KC)(t,i));case 4:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"createFlowMesh",value:function(){var e=(0,n.Z)(f.mark((function e(t,r){var n;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this._rasterJobHandler.instance,e.abrupt("return",n?n.createFlowMesh(t,r):(0,J.GE)(t.meshType,t.simulationSettings,t.flowData,(0,v.pC)(r.signal)?r.signal:(new AbortController).signal));case 2:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"normalizeRasterFetchOptions",value:function(e){var t=this.rasterInfo.multidimensionalInfo;if((0,v.Wi)(t))return e;var r=e.multidimensionalDefinition||this.multidimensionalDefinition;!(0,v.Wi)(r)&&r.length||(r=(0,N.Tj)(this.raster.rasterInfo));var n=e.timeExtent||this.timeExtent;if((0,v.pC)(r)&&(0,v.pC)(n)&&((0,v.pC)(n.start)||(0,v.pC)(n.end))){var a,s;r=r.map((function(e){return e.clone()}));var o=null===(a=t.variables.find((function(e){return e.name===r[0].variableName})))||void 0===a||null===(s=a.dimensions)||void 0===s?void 0:s.find((function(e){return"StdTime"===e.name})),l=r.find((function(e){return"StdTime"===e.dimensionName}));if(!o||!l)return(0,i.Z)((0,i.Z)({},e),{},{multidimensionalDefinition:null});var u=n.start,c=n.end,f=(0,v.Wi)(u)?null:u.getTime(),h=(0,v.Wi)(c)?null:c.getTime(),p=null!==f&&void 0!==f?f:h,d=null!==h&&void 0!==h?h:f;if((0,v.pC)(o.values)){var m=o.values.filter((function(e){if(Array.isArray(e)){if(p===d)return e[0]<=p&&e[1]>=p;var t=e[0]<=p&&e[1]>p||e[0]<d&&e[1]>=d,r=e[0]>=p&&e[1]<=d||e[0]<p&&e[1]>d;return t||r}return p===d?e===p:e>=p&&e<=d}));if(m.length){var y=m.sort((function(e,t){var r,n,i,a;return p===d?(null!==(r=e[0])&&void 0!==r?r:e)-(null!==(n=t[0])&&void 0!==n?n:t):Math.abs((null!==(i=e[1])&&void 0!==i?i:e)-d)-Math.abs((null!==(a=t[1])&&void 0!==a?a:t)-d)}))[0];l.values=[y]}else r=null}else if(o.hasRegularIntervals&&o.extent){var x=(0,R.Z)(o.extent,2),g=x[0],b=x[1];p>b||d<g?r=null:l.values=p===d?[p]:[Math.max(g,p),Math.min(b,d)]}}return(0,i.Z)((0,i.Z)({},e),{},{multidimensionalDefinition:r})}},{key:"updateRenderer",value:function(){var e=(0,n.Z)(f.mark((function e(){var t;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.loaded){e.next=2;break}return e.abrupt("return");case 2:if(JSON.stringify(this._cachedRendererJson)!==JSON.stringify(this.renderer)){e.next=4;break}return e.abrupt("return");case 4:if(t=this._rasterJobHandler.instance,e.t0=t,!e.t0){e.next=12;break}return this.symbolizer.rendererJSON=(0,H.ol)(this.renderer.toJSON()),this.symbolizer.bind(),e.next=11,t.updateSymbolizer(this.symbolizer);case 11:this._cachedRendererJson=this.renderer.toJSON();case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"applyRenderer",value:function(){var e=(0,n.Z)(f.mark((function e(t,r){var n,a,s,o;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t&&t.pixelBlock,(0,v.pC)(n)&&n.pixels&&n.pixels.length>0){e.next=3;break}return e.abrupt("return",null);case 3:return e.next=5,this.updateRenderer();case 5:if(s=this._rasterJobHandler.instance,o=this.bandIds,!s){e.next=12;break}return e.next=9,s.symbolize((0,i.Z)((0,i.Z)({},t),{},{simpleStretchParams:r,bandIds:o}));case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=this.symbolizer.symbolize((0,i.Z)((0,i.Z)({},t),{},{simpleStretchParams:r,bandIds:o}));case 13:return a=e.t0,e.abrupt("return",a);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"getTileUrl",value:function(e,t,r){return"RasterTileServer"===this.raster.datasetFormat?"".concat(this.url,"/tile/").concat(e,"/").concat(t,"/").concat(r):""}},{key:"getCompatibleTileInfo",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.loaded||(0,v.Wi)(t))return null;if(r&&e.equals(this.spatialReference))return this.tileInfo;var n=(0,B.C5)(e);return A.Z.create({size:256,spatialReference:e,origin:n?{x:n.origin[0],y:n.origin[1]}:{x:t.xmin,y:t.ymax}})}},{key:"getCompatibleFullExtent",value:function(e){return this.loaded?(this._compatibleFullExtent&&this._compatibleFullExtent.spatialReference.equals(e)||(this._compatibleFullExtent=this.raster.computeExtent(e)),this._compatibleFullExtent):null}},{key:"fetchTile",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var a,s,o,l=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=l.length>3&&void 0!==l[3]?l[3]:{}).requestAsImageElement){e.next=4;break}return s=this.getTileUrl(t,r,n),e.abrupt("return",(0,M.default)(s,{responseType:"image",query:(0,i.Z)((0,i.Z)({},this.refreshParameters),this.raster.ioConfig.customFetchParameters),signal:a.signal}).then((function(e){return e.data})));case 4:if(!(0,v.pC)(this.rasterInfo.multidimensionalInfo)||(a=this.normalizeRasterFetchOptions(a),!(0,v.Wi)(a.multidimensionalDefinition))){e.next=7;break}return o=a.tileInfo||this.rasterInfo.storageInfo.tileInfo,e.abrupt("return",{extent:this.raster.getTileExtentFromTileInfo(t,r,n,o),pixelBlock:null});case 7:return e.next=9,this._initJobHandler();case 9:return"raster-shaded-relief"===this.renderer.type&&(a=(0,i.Z)((0,i.Z)({},a),{},{buffer:{cols:1,rows:1}})),e.abrupt("return",this.raster.fetchTile(t,r,n,a));case 11:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"fetchPixels",value:function(){var e=(0,n.Z)(f.mark((function e(t,r,n){var i,a=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=a.length>3&&void 0!==a[3]?a[3]:{},!(0,v.pC)(this.rasterInfo.multidimensionalInfo)||(i=this.normalizeRasterFetchOptions(i),!(0,v.Wi)(i.multidimensionalDefinition))){e.next=5;break}e.t0={extent:t,pixelBlock:null},e.next=8;break;case 5:return e.next=7,this._initJobHandler();case 7:e.t0=this.raster.fetchPixels(t,r,n,i);case 8:return e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,this)})));return function(t,r,n){return e.apply(this,arguments)}}()},{key:"identify",value:function(){var e=(0,n.Z)(f.mark((function e(t){var r,n=arguments;return f.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.length>1&&void 0!==n[1]?n[1]:{},!(0,v.pC)(this.rasterInfo.multidimensionalInfo)){e.next=4;break}if(this.rasterInfo.hasMultidimensionalTranspose&&((0,N.WU)(r.multidimensionalDefinition)||r.transposedVariableName||r.timeExtent)||(r=this.normalizeRasterFetchOptions(r),!(0,v.Wi)(r.multidimensionalDefinition))){e.next=4;break}return e.abrupt("return",{location:t,value:null});case 4:return e.abrupt("return",this.raster.identify(t,r));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"increaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount++}},{key:"decreaseRasterJobHandlerUsage",value:function(){this._rasterJobHandler.refCount--,this._rasterJobHandler.refCount<=0&&this._shutdownJobHandler()}},{key:"hasStandardTime",value:function(){var e,t=this.rasterInfo.multidimensionalInfo;if((0,v.Wi)(t)||"standard-time"!==this.rasterInfo.dataType)return!1;var r=null===(e=this.multidimensionalDefinition[0])||void 0===e?void 0:e.variableName;return t.variables.some((function(e){return e.name===r&&e.dimensions.some((function(e){return"StdTime"===e.name}))}))}},{key:"getStandardTimeValue",value:function(e){return new Date(24*(e-25569)*3600*1e3).toString()}},{key:"_configDefaultSettings",value:function(){this._configDefaultInterpolation(),this.multidimensionalDefinition||(this.multidimensionalDefinition=(0,N.Tj)(this.raster.rasterInfo)),this._configDefaultRenderer()}},{key:"_initJobHandler",value:function(){var e=this;if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;var t=new E.Z;return this._rasterJobHandler.connectionPromise=t.initialize().then((function(){e._rasterJobHandler.instance=t,e.raster.rasterJobHandler=t,e.renderer&&e.updateRenderer()})).catch((function(){return null})),this._rasterJobHandler.connectionPromise}},{key:"_shutdownJobHandler",value:function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy(),this._rasterJobHandler.instance=null,this._rasterJobHandler.connectionPromise=null,this._rasterJobHandler.refCount=0,this.raster.rasterJobHandler=null,this._cachedRendererJson=null}},{key:"_configDefaultInterpolation",value:function(){if(null==this.interpolation){var e,t=(0,H.In)(this.rasterInfo,this.raster.tileType,null===(e=this.sourceJSON)||void 0===e?void 0:e.defaultResamplingMethod);this._set("interpolation",t)}}},{key:"_configDefaultRenderer",value:function(){var e=this.raster.rasterInfo;if(this.bandIds||(this.bandIds=(0,H.YD)(e)),!this.renderer){var t,r,n,i=(0,H.Ob)(e,{bandIds:this.bandIds,variableName:(0,v.pC)(this.multidimensionalDefinition)?null===(t=this.multidimensionalDefinition[0])||void 0===t?void 0:t.variableName:null});"WCSServer"===this.raster.datasetFormat&&"raster-stretch"===i.type&&((null===(r=e.statistics)||void 0===r?void 0:r[0].max)>1e24||(null===(n=e.statistics)||void 0===n?void 0:n[0].min)<-1e24)&&(i.dynamicRangeAdjustment=!0,i.statistics=null,"none"===i.stretchType&&(i.stretchType="min-max")),this.renderer=i}this.symbolizer?(this.symbolizer.rendererJSON=(0,H.ol)(this.renderer.toJSON()),this.symbolizer.rasterInfo=e):this.symbolizer=new W.Z({rendererJSON:this.renderer.toJSON(),rasterInfo:e});var a=this.symbolizer.bind();a.success||G.warn("imagery-tile-mixin",a.error||"The given renderer is not supported by the layer.")}}]),r}(e);return(0,h._)([(0,b.Cb)()],t.prototype,"_cachedRendererJson",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"_compatibleFullExtent",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"_rasterJobHandler",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"bandIds",void 0),(0,h._)([(0,b.Cb)({json:{origins:{service:{read:{source:"copyrightText"}}}}})],t.prototype,"copyright",void 0),(0,h._)([(0,b.Cb)({type:j.Z,json:{read:!1}}),(0,O.B)("rasterInfo.extent")],t.prototype,"fullExtent",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"interpolation",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"ioConfig",void 0),(0,h._)([(0,b.Cb)({type:[D.Z]})],t.prototype,"multidimensionalDefinition",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"raster",void 0),(0,h._)([(0,b.Cb)({readOnly:!0}),(0,O.B)("raster.rasterInfo")],t.prototype,"rasterInfo",void 0),(0,h._)([(0,b.Cb)()],t.prototype,"sourceJSON",void 0),(0,h._)([(0,b.Cb)({type:q.Z,json:{read:!1}}),(0,O.B)("rasterInfo.spatialReference")],t.prototype,"spatialReference",void 0),(0,h._)([(0,b.Cb)({type:A.Z,json:{read:!1}}),(0,O.B)("rasterInfo.storageInfo.tileInfo")],t.prototype,"tileInfo",void 0),(0,h._)([(0,b.Cb)(z.HQ)],t.prototype,"url",null),(0,h._)([(0,b.Cb)({types:d.dr})],t.prototype,"renderer",null),(0,h._)([(0,b.Cb)()],t.prototype,"symbolizer",void 0),t=(0,h._)([(0,C.j)("esri.layers.ImageryTileMixin")],t),t}((0,K.n)((0,X.Q)((0,y.R)(S.Z))))))))));(0,h._)([(0,b.Cb)({type:[w.z8],json:{write:{overridePolicy:function(){var e;return{enabled:!this.loaded||"Raster"===this.raster.tileType||"0,1,2"!==(null===(e=this.bandIds)||void 0===e?void 0:e.join(","))}}}}})],at.prototype,"bandIds",void 0),(0,h._)([(0,b.Cb)({json:{write:{overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType||"bilinear"!==this.interpolation}}}}}),(0,I.J)($.c)],at.prototype,"interpolation",void 0),(0,h._)([(0,b.Cb)({json:{write:!0}})],at.prototype,"multidimensionalDefinition",void 0),(0,h._)([(0,b.Cb)(z.rn)],at.prototype,"legendEnabled",void 0),(0,h._)([(0,b.Cb)({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:function(){return{enabled:!1}}}}})],at.prototype,"isReference",void 0),(0,h._)([(0,b.Cb)({type:["show","hide"]})],at.prototype,"listMode",void 0),(0,h._)([(0,b.Cb)({json:{read:!0,write:!0}})],at.prototype,"blendMode",void 0),(0,h._)([(0,b.Cb)()],at.prototype,"sourceJSON",void 0),(0,h._)([(0,b.Cb)({readOnly:!0,json:{origins:{service:{read:{source:"currentVersion"}}}}})],at.prototype,"version",void 0),(0,h._)([(0,b.Cb)()],at.prototype,"title",void 0),(0,h._)([(0,b.Cb)({readOnly:!0,json:{read:!1}})],at.prototype,"type",void 0),(0,h._)([(0,b.Cb)({type:["ArcGISTiledImageServiceLayer"]})],at.prototype,"operationalLayerType",void 0),(0,h._)([(0,b.Cb)({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader:function(e,t){return!t.disablePopup}},write:{target:"disablePopup",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}},writer:function(e,t,r){t[r]=!e}}}})],at.prototype,"popupEnabled",void 0),(0,h._)([(0,b.Cb)({type:p.Z,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:function(){return{enabled:!this.loaded||"Raster"===this.raster.tileType}}}}})],at.prototype,"popupTemplate",void 0),(0,h._)([(0,b.Cb)({readOnly:!0})],at.prototype,"defaultPopupTemplate",null),(0,h._)([(0,b.Cb)({readOnly:!0,type:[Q.Z]})],at.prototype,"fields",void 0),(0,h._)([(0,b.Cb)({readOnly:!0,type:[Q.Z]})],at.prototype,"rasterFields",null),(0,h._)([(0,b.Cb)({types:d.dr,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(){var e,t="raster-stretch"===(null===(e=this.renderer)||void 0===e?void 0:e.type)&&"none"===this.renderer.stretchType&&!this.renderer.useGamma;return{enabled:!this.loaded||"Raster"===this.raster.tileType||!t}}},origins:{"web-scene":{types:d.FK,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:function(e){return{enabled:e&&"vector-field"!==e.type&&"flow"!==e.type}}}}}}})],at.prototype,"renderer",null),(0,h._)([(0,_.r)("renderer")],at.prototype,"readRenderer",null);var st=at=(0,h._)([(0,C.j)("esri.layers.ImageryTileLayer")],at)},68328:function(e,t,r){r.d(t,{y:function(){return O}});var n,i=r(15861),a=r(1413),s=r(15671),o=r(43144),l=r(60136),u=r(29388),c=r(87757),f=r(98248),h=r(86755),p=r(76535),d=r(85111),m=r(77284),v=r(82447),y=r(84615),x=r(79055),g=r(5386),b=r(71453),k=r(27970),w=r(65445),I=r(68868),_=r(35569),C=r(59537),S=(r(65343),r(2148)),T=r(48916),Z=r(37924),R=function(){function e(){(0,s.Z)(this,e),this.location={left:0,top:0,width:0,height:0},this._allAvailability="unknown",this.byteSize=40}return(0,o.Z)(e,[{key:"getAvailability",value:function(e,t){if("unknown"!==this._allAvailability)return this._allAvailability;var r=(e-this.location.top)*this.location.width+(t-this.location.left),n=r%8,i=r>>3,a=this._tileAvailabilityBitSet;return i<0||i>a.length?"unknown":a[i]&1<<n?"available":"unavailable"}},{key:"_updateFromData",value:function(e){for(var t=this.location.width,r=this.location.height,n=!0,i=!0,a=Math.ceil(t*r/8),s=new Uint8Array(a),o=0,l=0;l<e.length;l++){var u=l%8;e[l]?(i=!1,s[o]|=1<<u):n=!1,7===u&&++o}i?this._allAvailability="unavailable":n?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=s,this.byteSize+=s.length)}}],[{key:"fromDefinition",value:function(t,r){var n=t.service.request||h.default,i=t.row,s=t.col,o=t.width,l=t.height,u={query:{f:"json"}};return r=r?(0,a.Z)((0,a.Z)({},u),r):u,n(function(e){var t;if("vector-tile"===e.service.type)t="".concat(e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height);else{var r=e.service.tileServers;t="".concat(r&&r.length?r[e.row%r.length]:e.service.url,"/tilemap/").concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var n=e.service.query;return n&&(t="".concat(t,"?").concat(n)),t}(t),r).then((function(e){return e.data})).catch((function(e){if(e&&e.details&&422===e.details.httpStatus)return{location:{top:i,left:s,width:o,height:l},valid:!0,data:(0,C.a9)(o*l,0)};throw e})).then((function(t){if(t.location&&(t.location.top!==i||t.location.left!==s||t.location.width!==o||t.location.height!==l))throw new m.Z("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:i,left:s,width:o,height:l}});return e.fromJSON(t)}))}},{key:"fromJSON",value:function(t){e._validateJSON(t);var r=new e;return r.location=Object.freeze((0,Z.d9)(t.location)),r._updateFromData(t.data),Object.freeze(r)}},{key:"_validateJSON",value:function(e){if(!e||!e.location)throw new m.Z("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new m.Z("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new m.Z("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new m.Z("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new m.Z("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")}}]),e}();function M(e){return"".concat(e.level,"/").concat(e.row,"/").concat(e.col,"/").concat(e.width,"/").concat(e.height)}var P=y.Z.getLogger("esri.layers.support.TilemapCache"),O=n=function(e){(0,l.Z)(r,e);var t=(0,u.Z)(r);function r(e){var n;return(0,s.Z)(this,r),(n=t.call(this,e))._pendingTilemapRequests={},n._availableLevels={},n.levels=5,n.cacheByteSize=2*d.Y8.MEGABYTES,n.request=h.default,n._prefetchingEnabled=!0,n}return(0,o.Z)(r,[{key:"initialize",value:function(){var e=this;this._tilemapCache=new x.Z(this.cacheByteSize),this.own([(0,k.YP)((function(){var t=e.layer;return[null===t||void 0===t?void 0:t.parsedUrl,null===t||void 0===t?void 0:t.tileServers,null===t||void 0===t?void 0:t.apiKey,null===t||void 0===t?void 0:t.customParameters]}),(function(){return e._initializeTilemapDefinition()})),(0,k.YP)((function(){var t,r;return null===(t=e.layer)||void 0===t||null===(r=t.tileInfo)||void 0===r?void 0:r.lods}),(function(t){return e._initializeAvailableLevels(t)}),k.tX)]),this._initializeTilemapDefinition()}},{key:"castLevels",value:function(e){return e<=2?(P.error("Minimum levels for Tilemap is 3, but got ",e),3):e}},{key:"size",get:function(){return 1<<this.levels}},{key:"fetchTilemap",value:function(e,t,r,n){var i=this;if(!this._availableLevels[e])return Promise.reject(new m.Z("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")));var s=this._tmpTilemapDefinition,o=this._tilemapFromCache(e,t,r,s);if(o)return Promise.resolve(o);var l=n&&n.signal;return n=(0,a.Z)((0,a.Z)({},n),{},{signal:null}),new Promise((function(e,t){(0,b.fu)(l,(function(){return t((0,b.zE)())}));var r=M(s),a=i._pendingTilemapRequests[r];if(!a){a=R.fromDefinition(s,n).then((function(e){return i._tilemapCache.put(r,e,e.byteSize),e}));var o=function(){return delete i._pendingTilemapRequests[r]};i._pendingTilemapRequests[r]=a,a.then(o,o)}a.then(e,t)}))}},{key:"getAvailability",value:function(e,t,r){if(!this._availableLevels[e])return"unavailable";var n=this._tilemapFromCache(e,t,r,this._tmpTilemapDefinition);return n?n.getAvailability(t,r):"unknown"}},{key:"fetchAvailability",value:function(e,t,r,n){return this._availableLevels[e]?this.fetchTilemap(e,t,r,n).catch((function(e){return e})).then((function(n){if(n instanceof R){var i=n.getAvailability(t,r);if("unavailable"===i)throw new m.Z("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:r});return i}if((0,b.D_)(n))throw n;return"unknown"})):Promise.reject(new m.Z("tilemap-cache:level-unavailable","Level ".concat(e," is unavailable in the service")))}},{key:"fetchAvailabilityUpsample",value:function(e,t,r,n,i){var a=this;n.level=e,n.row=t,n.col=r;var s=this.layer.tileInfo;s.updateTileInfo(n);var o=this.fetchAvailability(e,t,r,i).catch((function(e){if((0,b.D_)(e))throw e;if(s.upsampleTile(n))return a.fetchAvailabilityUpsample(n.level,n.row,n.col,n);throw e}));return this._fetchAvailabilityUpsamplePrefetch(n.id,e,t,r,i,o),o}},{key:"_fetchAvailabilityUpsamplePrefetch",value:function(){var e=(0,i.Z)(c.mark((function e(t,r,i,s,o,l){var u,f,h,p,d,m,v,y,x,g=this;return c.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._prefetchingEnabled){e.next=2;break}return e.abrupt("return");case 2:if(u="prefetch-".concat(t),!this.handles.has(u)){e.next=5;break}return e.abrupt("return");case 5:return f=new AbortController,l.then((function(){return f.abort()}),(function(){return f.abort()})),h=!1,p={remove:function(){h||(h=!0,f.abort())}},this.handles.add(p,u),e.next=12,(0,w.MU)(10,f.signal).catch((function(){}));case 12:if(h||(h=!0,this.handles.remove(u)),!(0,b.Hc)(f)){e.next=15;break}return e.abrupt("return");case 15:for(d={id:t,level:r,row:i,col:s},m=(0,a.Z)((0,a.Z)({},o),{},{signal:f.signal}),v=this.layer.tileInfo,y=function(e){var t=g.fetchAvailability(d.level,d.row,d.col,m);n._prefetches.push(t);var r=function(){n._prefetches.removeUnordered(t)};t.then(r,r)},x=0;n._prefetches.length<n._maxPrefetch&&v.upsampleTile(d);++x)y();case 18:case"end":return e.stop()}}),e,this)})));return function(t,r,n,i,a,s){return e.apply(this,arguments)}}()},{key:"_initializeTilemapDefinition",value:function(){var e;if(this.layer.parsedUrl){var t=this.layer,r=t.parsedUrl,n=t.apiKey,i=t.customParameters;this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:r.path,query:(0,I.B7)((0,a.Z)((0,a.Z)((0,a.Z)({},r.query),i),{},{token:null!==n&&void 0!==n?n:null===(e=r.query)||void 0===e?void 0:e.token})),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}}},{key:"_tilemapFromCache",value:function(e,t,r,n){n.level=e,n.row=t-t%this.size,n.col=r-r%this.size;var i=M(n);return this._tilemapCache.get(i)}},{key:"_initializeAvailableLevels",value:function(e){var t=this;this._availableLevels={},e&&e.forEach((function(e){return t._availableLevels[e.level]=!0}))}},{key:"test",get:function(){var e=this;return{get prefetchingEnabled(){return e._prefetchingEnabled},set prefetchingEnabled(t){e._prefetchingEnabled=t},hasTilemap:function(t,r,n){return!!e._tilemapFromCache(t,r,n,e._tmpTilemapDefinition)}}}}]),r}((0,v.p)(p.Z));O._maxPrefetch=4,O._prefetches=new g.Z({initialSize:n._maxPrefetch}),(0,f._)([(0,_.Cb)({constructOnly:!0,type:Number})],O.prototype,"levels",void 0),(0,f._)([(0,S.p)("levels")],O.prototype,"castLevels",null),(0,f._)([(0,_.Cb)({readOnly:!0,type:Number})],O.prototype,"size",null),(0,f._)([(0,_.Cb)({constructOnly:!0,type:Number})],O.prototype,"cacheByteSize",void 0),(0,f._)([(0,_.Cb)({constructOnly:!0})],O.prototype,"layer",void 0),(0,f._)([(0,_.Cb)({constructOnly:!0})],O.prototype,"request",void 0),O=n=(0,f._)([(0,T.j)("esri.layers.support.TilemapCache")],O)},77678:function(e,t,r){r.d(t,{OE:function(){return d},Gc:function(){return y},Qg:function(){return m},Rq:function(){return f},gX:function(){return v},z2:function(){return h},ET:function(){return p},Vx:function(){return g}});r(32224);var n=r(77822),i=r(15671),a=r(43144),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;(0,i.Z)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return(0,a.Z)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.refCount--,i.refCount<=0&&(n.delete(r),i.controller&&i.controller.abort()),i.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,n=this._cachedBlocks;if(n.has(r)){var i=n.get(r);return i.ts=Date.now(),i.refCount++,n.delete(r),n.set(r,i),i.block}return null}},{key:"putBlock",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=this._cachedBlocks,a=e+"/"+t;if(i.has(a)){var s=i.get(a);s.ts=Date.now(),s.refCount++}else i.set(a,{block:r,ts:Date.now(),refCount:1,controller:n});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,n=e+"/"+t;r.has(n)&&r.delete(n)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),n=Date.now(),i=0;i<r.length&&r[i][1].ts<=n-e._duration;i++)t.delete(r[i][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),o=r(17445),l=r(3717),u=new Map,c=new s;function f(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function h(e,t){var r={extent:null,rasterInfo:t,cache:new Map};if(u.has(e)){var n=u.get(e);return n.push(r),n.length-1}return u.set(e,[r]),0}function p(e,t){if(u.has(e)){var r=u.get(e);r[t]=null,r.some((function(e){return null!=e}))||u.delete(e)}}function d(e,t,r){if(!u.has(e))return null==t?c.decreaseRefCount(e,r):0;var n=u.get(e);if(null==n[t])return c.decreaseRefCount(e,r);var i=n[t].cache;if(i.has(r)){var a=i.get(r);if(a.refCount--,0===a.refCount){i.delete(r);for(var s=0;s<n.length;s++)n[s]&&n[s].cache.has(r)&&n[s].cache.delete(r);a.controller&&a.controller.abort()}return a.refCount}return 0}function m(e,t,r){if(!u.has(e))return null==t?c.getBlock(e,r):null;var n=u.get(e);if(null==n[t]){for(var i=0;i<n.length;i++)if(n[i]&&n[i].cache.has(r)){var a=n[i].cache.get(r);return a.refCount++,a.block}return c.getBlock(e,r)}var s=n[t].cache;if(s.has(r)){var o=s.get(r);return o.refCount++,o.block}for(var l=0;l<n.length;l++)if(l!==t&&n[l]&&n[l]&&n[l].cache.has(r)){var f=n[l].cache.get(r);return f.refCount++,s.set(r,f),f.block}return null}function v(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;if(u.has(e)){var a=u.get(e);if(null!=a[t]){var s={refCount:1,block:n,isResolved:!1,isRejected:!1,controller:i};n.then((function(){return s.isResolved=!0})).catch((function(){return s.isRejected=!0})),a[t].cache.set(r,s)}else c.putBlock(e,r,n,i)}else null==t&&c.putBlock(e,r,n,i)}function y(e,t,r){if(u.has(e)){var n=u.get(e);null!=n[t]?n[t].cache.delete(r):c.deleteBlock(e,r)}else null==t&&c.deleteBlock(e,r)}function x(e,t){if(!u.has(e))return null;var r=u.get(e);return null==r[t]?null:r[t]}function g(e,t,r,i,a,s){var u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,c=x(e,t),f=c.extent,h=c.cache,p=c.rasterInfo;if(!f||f.xmin!==r.xmin||f.xmax!==r.xmax||f.ymin!==r.ymin||f.ymax!==r.ymax){for(var d=r.clone().normalize(),m=p.spatialReference,v=p.transform,y=new Set,g=0;g<d.length;g++){var b=d[g];if(!(b.xmax-b.xmin<=i||b.ymax-b.ymin<=i)){var k=(0,o.tB)(b,m,u);(0,n.pC)(v)&&(k=v.inverseTransform(k));var w=new l.Z({x:i,y:i,spatialReference:b.spatialReference});if(null==a&&!(a=(0,o.VO)(w,m,b,u)))return;var I=(0,o.kr)(a,p,s||"closest"),_=I.pyramidLevel,C=I.pyramidResolution,S=I.excessiveReading;if(S)return;for(var T=p.storageInfo,Z=T.origin,R={x:Math.max(0,Math.floor((k.xmin-Z.x)/C.x)),y:Math.max(0,Math.floor((Z.y-k.ymax)/C.y))},M=Math.ceil((k.xmax-k.xmin)/C.x-.1),P=Math.ceil((k.ymax-k.ymin)/C.y-.1),O=_>0?T.pyramidBlockWidth:T.blockWidth,B=_>0?T.pyramidBlockHeight:T.blockHeight,F=1,z=Math.max(0,Math.floor(R.x/O)-F),D=Math.max(0,Math.floor(R.y/B)-F),E=Math.floor((R.x+M-1)/O)+F,A=Math.floor((R.y+P-1)/B)+F,N=D;N<=A;N++)for(var L=z;L<=E;L++)y.add("".concat(_,"/").concat(N,"/").concat(L))}}h.forEach((function(e,t){if(!y.has(t)){var r=h.get(t);(null==r||r.isResolved||r.isRejected)&&h.delete(t)}})),c.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}},25886:function(e,t,r){r.d(t,{Z:function(){return h}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(98248),l=r(8410),u=r(35569),c=(r(59537),r(65343),r(61340),r(48916)),f=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,n.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"affectsPixelSize",get:function(){return!1}},{key:"forwardTransform",value:function(e){return e}},{key:"inverseTransform",value:function(e){return e}}]),r}(l.wq);(0,o._)([(0,u.Cb)()],f.prototype,"affectsPixelSize",null),(0,o._)([(0,u.Cb)({json:{write:!0}})],f.prototype,"spatialReference",void 0);var h=f=(0,o._)([(0,c.j)("esri.layers.support.rasterTransforms.BaseRasterTransform")],f)},63325:function(e,t,r){r.d(t,{Z:function(){return h}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(98248),l=r(35569),u=(r(59537),r(65343),r(61340),r(92167)),c=r(48916),f=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).type="gcs-shift",e.tolerance=1e-8,e}return(0,i.Z)(r,[{key:"forwardTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x>180+this.tolerance&&(e.x-=360),e):(e.xmin>=180-this.tolerance?(e.xmax-=360,e.xmin-=360):e.xmax>180+this.tolerance&&(e.xmin=-180,e.xmax=180),e)}},{key:"inverseTransform",value:function(e){return"point"===(e=e.clone()).type?(e.x<-this.tolerance&&(e.x+=360),e):(e.xmin<-this.tolerance&&(e.xmin+=360,e.xmax+=360),e)}}]),r}(r(25886).Z);(0,o._)([(0,u.J)({GCSShiftXform:"gcs-shift"})],f.prototype,"type",void 0),(0,o._)([(0,l.Cb)()],f.prototype,"tolerance",void 0);var h=f=(0,o._)([(0,c.j)("esri.layers.support.rasterTransforms.GCSShiftTransform")],f)},35186:function(e,t,r){r.d(t,{Z:function(){return b}});var n=r(15671),i=r(43144),a=r(60136),s=r(29388),o=r(29439),l=r(98248),u=(r(32224),r(35569)),c=(r(59537),r(65343),r(61340),r(92167)),f=r(96326),h=r(48916),p=r(57),d=r(25886),m=r(3717),v=r(13179);function y(e,t,r){var n=t.x,i=t.y;if(r<2)return{x:e[0]+n*e[2]+i*e[4],y:e[1]+n*e[3]+i*e[5]};if(2===r){var a=n*n,s=i*i,o=n*i;return{x:e[0]+n*e[2]+i*e[4]+a*e[6]+o*e[8]+s*e[10],y:e[1]+n*e[3]+i*e[5]+a*e[7]+o*e[9]+s*e[11]}}var l=n*n,u=i*i,c=n*i,f=l*n,h=l*i,p=n*u,d=i*u;return{x:e[0]+n*e[2]+i*e[4]+l*e[6]+c*e[8]+u*e[10]+f*e[12]+h*e[14]+p*e[16]+d*e[18],y:e[1]+n*e[3]+i*e[5]+l*e[7]+c*e[9]+u*e[11]+f*e[13]+h*e[15]+p*e[17]+d*e[19]}}function x(e,t,r){var n=t.xmin,i=t.ymin,a=t.xmax,s=t.ymax,o=t.spatialReference,l=[];if(r<2)l.push({x:n,y:s}),l.push({x:a,y:s}),l.push({x:n,y:i}),l.push({x:a,y:i});else{for(var u=10,c=0;c<u;c++)l.push({x:n,y:i+(s-i)*c/(u-1)}),l.push({x:a,y:i+(s-i)*c/(u-1)});u=8;for(var f=1;f<=u;f++)l.push({x:n+(a-n)*f/u,y:i}),l.push({x:n+(a-n)*f/u,y:s})}l=l.map((function(t){return y(e,t,r)}));var h=l.map((function(e){return e.x})),p=l.map((function(e){return e.y}));return new v.Z({xmin:Math.min.apply(null,h),xmax:Math.max.apply(null,h),ymin:Math.min.apply(null,p),ymax:Math.max.apply(null,p),spatialReference:o})}var g=function(e){(0,a.Z)(r,e);var t=(0,s.Z)(r);function r(){var e;return(0,n.Z)(this,r),(e=t.apply(this,arguments)).polynomialOrder=1,e.type="polynomial",e}return(0,i.Z)(r,[{key:"readForwardCoefficients",value:function(e,t){var r=t.coeffX,n=t.coeffY;if(null===r||void 0===r||!r.length||null===n||void 0===n||!n.length||r.length!==n.length)return null;for(var i=[],a=0;a<r.length;a++)i.push(r[a]),i.push(n[a]);return i}},{key:"writeForwardCoefficients",value:function(e,t,r){for(var n=[],i=[],a=0;a<(null===e||void 0===e?void 0:e.length);a++)a%2==0?n.push(e[a]):i.push(e[a]);t.coeffX=n,t.coeffY=i}},{key:"inverseCoefficients",get:function(){var e=this._get("inverseCoefficients"),t=this._get("forwardCoefficients");return!e&&t&&this.polynomialOrder<2&&(e=function(e){var t=(0,o.Z)(e,6),r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],l=t[5],u=i*l-s*a,c=s*a-i*l;return[(s*n-r*l)/u,(i*n-r*a)/c,l/u,a/c,-s/u,-i/c]}(t)),e},set:function(e){this._set("inverseCoefficients",e)}},{key:"readInverseCoefficients",value:function(e,t){var r=t.inverseCoeffX,n=t.inverseCoeffY;if(null===r||void 0===r||!r.length||null===n||void 0===n||!n.length||r.length!==n.length)return null;for(var i=[],a=0;a<r.length;a++)i.push(r[a]),i.push(n[a]);return i}},{key:"writeInverseCoefficients",value:function(e,t,r){for(var n=[],i=[],a=0;a<(null===e||void 0===e?void 0:e.length);a++)a%2==0?n.push(e[a]):i.push(e[a]);t.inverseCoeffX=n,t.inverseCoeffY=i}},{key:"affectsPixelSize",get:function(){return this.polynomialOrder>0}},{key:"forwardTransform",value:function(e){if("point"===e.type){var t=y(this.forwardCoefficients,e,this.polynomialOrder);return new m.Z({x:t.x,y:t.y,spatialReference:e.spatialReference})}return x(this.forwardCoefficients,e,this.polynomialOrder)}},{key:"inverseTransform",value:function(e){if("point"===e.type){var t=y(this.inverseCoefficients,e,this.polynomialOrder);return new m.Z({x:t.x,y:t.y,spatialReference:e.spatialReference})}return x(this.inverseCoefficients,e,this.polynomialOrder)}}]),r}(d.Z);(0,l._)([(0,u.Cb)({json:{write:!0}})],g.prototype,"polynomialOrder",void 0),(0,l._)([(0,u.Cb)()],g.prototype,"forwardCoefficients",void 0),(0,l._)([(0,f.r)("forwardCoefficients",["coeffX","coeffY"])],g.prototype,"readForwardCoefficients",null),(0,l._)([(0,p.c)("forwardCoefficients")],g.prototype,"writeForwardCoefficients",null),(0,l._)([(0,u.Cb)({json:{write:!0}})],g.prototype,"inverseCoefficients",null),(0,l._)([(0,f.r)("inverseCoefficients",["inverseCoeffX","inverseCoeffY"])],g.prototype,"readInverseCoefficients",null),(0,l._)([(0,p.c)("inverseCoefficients")],g.prototype,"writeInverseCoefficients",null),(0,l._)([(0,u.Cb)()],g.prototype,"affectsPixelSize",null),(0,l._)([(0,c.J)({PolynomialXform:"polynomial"})],g.prototype,"type",void 0);var b=g=(0,l._)([(0,h.j)("esri.layers.support.rasterTransforms.PolynomialTransform")],g)},1792:function(e,t,r){r.d(t,{j:function(){return v},c:function(){return y}});var n=r(63325),i=r(43144),a=r(15671),s=r(60136),o=r(29388),l=r(98248),u=(r(84615),r(61340),r(59537),r(65343),r(27445),r(92167)),c=r(48916),f=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).type="identity",e}return(0,i.Z)(r)}(r(25886).Z);(0,l._)([(0,u.J)({IdentityXform:"identity"})],f.prototype,"type",void 0);var h=f=(0,l._)([(0,c.j)("esri.layers.support.rasterTransforms.IdentityTransform")],f),p=r(35186),d={GCSShiftXform:n.Z,IdentityXform:h,PolynomialXform:p.Z},m=Object.keys(d);function v(e){var t=null===e||void 0===e?void 0:e.type;return!e||m.includes(t)}function y(e){if(!(null===e||void 0===e?void 0:e.type))return null;var t=d[null===e||void 0===e?void 0:e.type];if(t){var r=new t;return r.read(e),r}return null}},73620:function(e,t,r){r.d(t,{d:function(){return s},h:function(){return a}});var n=r(1413),i=r(13996),a={type:i.Z,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:s}}}}};function s(e,t,r,a){if(!e)return null;var s=t.minScale,o=t.maxScale,l=t.minLOD,u=t.maxLOD;if(null!=l&&null!=u)return a&&a.ignoreMinMaxLOD?i.Z.fromJSON(e):i.Z.fromJSON((0,n.Z)((0,n.Z)({},e),{},{lods:e.lods.filter((function(e){var t=e.level;return null!=t&&t>=l&&t<=u}))}));if(0!==s&&0!==o){var c=function(e){return Math.round(1e4*e)/1e4},f=s?c(s):1/0,h=o?c(o):-1/0;return i.Z.fromJSON((0,n.Z)((0,n.Z)({},e),{},{lods:e.lods.filter((function(e){var t=c(e.scale);return t<=f&&t>=h}))}))}return i.Z.fromJSON(e)}}}]);